<!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="https://fonts.loli.net/css?family=Noto+Serif+SC:400,500,700&display=swap&subset=chinese-simplified" rel="stylesheet"><link href="https://fonts.loli.net/css?family=Parisienne" rel="stylesheet"><link href="https://fonts.loli.net/css?family=Pinyon+Script" rel="stylesheet"><link href="https://fonts.loli.net/css?family=EB+Garamond:400,500,700" rel="stylesheet"><link href="https://fonts.loli.net/css?family=Source+Code+Pro:400,700" rel="stylesheet"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/logo-32x32.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/logo-16x16.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="学习笔记,python,pygame,"><meta name="description" content="使用Pygame扩展，编写功能齐备的全屏街机游戏。参考《python基础教程》"><meta name="keywords" content="学习笔记,python,pygame"><meta property="og:type" content="article"><meta property="og:title" content="pygame练习之DIY街机小游戏"><meta property="og:url" content="https://chennq.top/pygame学习/20190414-pygame-DIY-banana-and-plumb.html"><meta property="og:site_name" content="Naqin"><meta property="og:description" content="使用Pygame扩展，编写功能齐备的全屏街机游戏。参考《python基础教程》"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://chennq.top/pygame学习/20190414-pygame-DIY-banana-and-plumb/%E7%95%8C%E9%9D%A2.png"><meta property="og:image" content="https://chennq.top/pygame学习/20190414-pygame-DIY-banana-and-plumb/%E6%B8%B8%E6%88%8F%E4%B8%AD.png"><meta property="og:image" content="https://chennq.top/pygame学习/20190414-pygame-DIY-banana-and-plumb/UML.jpg"><meta property="og:image" content="https://chennq.top/pygame学习/20190414-pygame-DIY-banana-and-plumb/UML-objects.jpg"><meta property="og:updated_time" content="2019-11-04T17:04:36.114Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="pygame练习之DIY街机小游戏"><meta name="twitter:description" content="使用Pygame扩展，编写功能齐备的全屏街机游戏。参考《python基础教程》"><meta name="twitter:image" content="https://chennq.top/pygame学习/20190414-pygame-DIY-banana-and-plumb/%E7%95%8C%E9%9D%A2.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"5.1.4",sidebar:{position:"left",display:"hide",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1,dimmer:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!0,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://chennq.top/pygame学习/20190414-pygame-DIY-banana-and-plumb.html"><title>pygame练习之DIY街机小游戏 | Naqin</title><meta name="baidu-site-verification" content="rqAw8UHNKS"><meta name="google-site-verification" content="r_iyjm0f8KcvC9kIpQiyZx3pmWlLY-gwBv9KsOF2AYo"></head><body itemscope itemtype="https://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="https://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Naqin</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Run! Forest,run!</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section">首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section">关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section">标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section">分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section">归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger">搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="https://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://chennq.top/pygame学习/20190414-pygame-DIY-banana-and-plumb.html"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Naqin"><meta itemprop="description" content><meta itemprop="image" content="/uploads/tu6.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Naqin"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">pygame练习之DIY街机小游戏</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-14T19:56:54+08:00">2019-04-14 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/pygame学习/" itemprop="url" rel="index"><span itemprop="name">pygame学习</span></a></span></span><div class="post-wordcount"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">5.5k 字</span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote class="blockquote-center"><p>使用Pygame扩展，编写功能齐备的全屏街机游戏。参考《python基础教程》</p></blockquote><a id="more"></a><hr><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>如何编写计算机游戏呢？游戏的基本设计过程与其他程序类似，但开发对象模型前， 必须先设计游戏本身，如游戏包含的角色、所处的环境以及要实现的目标。</p><p>这里将创建的游戏是从巨蟒剧团推出的著名短剧“Self-Defense Against Fresh Fruit”改编而 来的。在这个短剧中，军士长John Cleese指挥士兵使用防守战术抵御入侵者使用新鲜水果（如石 榴、糖水芒果、青梅和香蕉）发起的进攻。防守战术包括使用枪支、放老虎以及在敌人头顶扔下 重达16吨的铅锤。在这个游戏中，我们将反过来，让玩家控制一支香蕉。这支香蕉要躲开从天而 降的16吨铅锤，尽力在防御战中活下来。我想将这个游戏命名为Squish比较合适。</p><p>这个项目的目标是围绕着游戏设计展开的。这款游戏必须像设计的那样：香蕉能够移动，16 吨的铅锤从天而降。另外，与往常一样，代码必须是模块化的，且易于扩展。一个重要的需求是， 设计应包含一些游戏状态（如游戏简介、关卡和“游戏结束”状态），同时可轻松地添加新状态。</p><h2 id="有用的工具"><a href="#有用的工具" class="headerlink" title="有用的工具"></a>有用的工具</h2><h3 id="pygame"><a href="#pygame" class="headerlink" title="pygame"></a>pygame</h3><p>模块pygame自动导入其他所有的Pygame模块。如pygame.display和pygame.font。</p><p>模块pygame包含函数Surface，它返回一个新的Surface对象。Surface对象其实就是一个指定尺寸的空图像，可用来绘画和传送。传送（调用Surface对象的方法blit）意味着在Surface之间 传输内容。［传送的英文单词blit是从技术术语块传输（block transfer）的简写BLT衍生而来的。］</p><p>函数<strong>init</strong>是Pygame游戏的核心，必须在游戏进入主事件循环前调用。这个函数<u>自动初始化其他所有模块</u>（如font和image）。</p><p>如果要捕获Pygame特有的错误，就需要使用error类。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import pygame, sys</span><br><span class="line">from pygame.locals import *</span><br><span class="line"></span><br><span class="line">white = <span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span></span><br><span class="line">black = <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">pygame.init()</span><br><span class="line"></span><br><span class="line">screen = pygame.display.set_mode((<span class="number">500</span>, <span class="number">500</span>))</span><br><span class="line">myfront = pygame.font.Font(None,<span class="number">60</span>)</span><br><span class="line">textImage = myfront.render(<span class="string">"Hello Pygame"</span>, True, black)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> True:		<span class="comment"># 死循环确保窗口一直显示</span></span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():     <span class="comment"># 遍历所有事件</span></span><br><span class="line">        <span class="keyword">if</span> event.type <span class="keyword">in</span> (QUIT, KEYDOWN): <span class="comment"># 单击关闭窗口，或键盘输入就退出</span></span><br><span class="line">            sys.<span class="keyword">exit</span>()</span><br><span class="line">    screen.fill(white)					<span class="comment"># 白色填充</span></span><br><span class="line">    screen.blit(textImage, (<span class="number">100</span>, <span class="number">100</span>))  <span class="comment"># 改变画面，加上字</span></span><br><span class="line">    pygame.display.update() 			<span class="comment"># 更新画面</span></span><br></pre></td></tr></table></figure><h3 id="pygame-locals"><a href="#pygame-locals" class="headerlink" title="pygame.locals"></a>pygame.locals</h3><p>模块pygame.locals包含你可能在自定义模块的作用域内使用的名称（变量），如事件类型、 键、视频模式等的名称。可导入这个模块的所有内容（from pygame.locals import *），但如果知道需要哪些名称，应该做更具体的导入，如from pygame.locals import FULLSCREEN。</p><h3 id="pygame-display"><a href="#pygame-display" class="headerlink" title="pygame.display"></a>pygame.display</h3><p>模块pygame.display包含处理<strong>内容显示</strong>的函数，这些内容可显示在普通窗口中，也可占据整个屏幕。在这个项目中，需要用到如下函数。</p><ul><li>flip：更新显示。一般而言，分两步来修改当前屏幕。首先，对函数get_surface返回 的Surface对象做必要的修改，然后调用pygame.display.flip来更新显示，反映出所做 的修改。</li><li>update：只想更新屏幕的一部分时，使用这个函数，而不是flip。调用这个函数时，可只 提供一个参数，即RenderUpdates类的方法draw返回的矩形列表。</li><li>set_mode：设置显示的尺寸和类型。显示模式有多种，但这里只使用全屏模式和默认模式 “在窗口中显示”。</li><li>set_caption：设置Pygame程序的标题。函数set_caption主要用于游戏在窗口中运行（而不是以全屏模式运行）时，因为标题将用作窗口的标题。</li><li>get_surface：返回一个Surface对象，你可在其中绘制图形，再调用pygame.display.flip 或pygame.display.blit。这个项目只使用了Surface对象的一个方法来绘画，这就是<strong>blit</strong>， <u>它将一个Surface对象中的图形传输到另一个Surface对象的指定位置</u>。另外，还将使用 Group对象的方法draw在Surface上绘制Sprite对象。</li></ul><h3 id="pygame-font"><a href="#pygame-font" class="headerlink" title="pygame.font"></a>pygame.font</h3><p>模块pygame.font包含函数Font。字体对象用于表示不同的字体，可用于将文本渲染为可在 Pygame中作为普通图形使用的图像。</p><h3 id="pygame-sprite-（小精灵）"><a href="#pygame-sprite-（小精灵）" class="headerlink" title="pygame.sprite （小精灵）"></a>pygame.sprite （小精灵）</h3><p>模块pygame.sprite包含两个非常重要的类：Sprite和Group。</p><p>Sprite类是<strong>所有可见游戏对象</strong>（在这个项目中，是香蕉和重16吨的铅锤）的<strong>基类</strong>。要实现自 定义的游戏对象，可从Sprite派生出子类，并重写构造函数以设置其属性image和rect（这些属性 决定了Sprite的外观和位置），同时重写在Sprite可能需要更新时调用的方法update。</p><p>Group及其子类的实例用作<strong>Sprite对象的容器</strong>。一般而言，使用Group是个不错的主意。在简 单的游戏（如本章的项目）中，只需创建一个名为sprites或allsprites之类的Group，并将所有 Sprite都添加到其中。这样，当你调用Group对象的方法update时，将自动调用所有Sprite对象的方法update。另外，Group对象的方法clear用于清除它包含的所有Sprite对象（实际的清理工作是使用一个回调函数完成的），而方法draw可用于绘制所有的Sprite对象。</p><p>在这个项目中，将使用Group的子类RenderUpdates，其方法draw返回列表，其中包含所有受 到影响的矩形。可将这个列表传递给pygame.display.update，以只更新需要更新的部分。通过这 样做，有可能极大地改善游戏的性能。</p><h3 id="pygame-mouse"><a href="#pygame-mouse" class="headerlink" title="pygame.mouse"></a>pygame.mouse</h3><p>在即将开发的游戏Squish中，只使用模块<code>pygame.mouse</code>来做两件事情：隐藏鼠标以及获取鼠标的位置。这两件事分别是使用<code>pygame.mouse.set_visible(False)</code>和<code>pygame.mouse.get_pos()</code> 来完成的。</p><h3 id="pygame-event"><a href="#pygame-event" class="headerlink" title="pygame.event"></a>pygame.event</h3><p>模块<code>pygame.event</code>跟踪各种事件，如鼠标单击、鼠标移动、按下或松开键等。要获取最近发生的事件列表，可使用函数<code>pygame.event.get</code>。</p><p>如果只需要状态信息，如<code>pygame.mouse.get_pos</code>返回的鼠标位置，就无需使用<code>pygame.event.get</code>。 然而，你需要确保<code>Pygame</code>同步地更新，为此可定期调用函数<code>pygame.event.pump</code>。</p><h3 id="pygame-image"><a href="#pygame-image" class="headerlink" title="pygame.image"></a>pygame.image</h3><p>模块pygame.image用于处理图像，如以GIF、PNG、JPEG和其他几种文件格式存储的图像。 在这个项目中，只需要这个模块中的函数load，它读取图像文件并创建一个包含该图像的Surface 对象。</p><h3 id="pygame-Rect"><a href="#pygame-Rect" class="headerlink" title="pygame.Rect"></a>pygame.Rect</h3><p>Rect是用于存储矩形坐标的pygame对象。</p><p>rect对象有一些虚拟属性，比如top.left,bottom.right这些是用来固定矩形的位置的，</p><p>还有size,width,height，这些是描述矩形大小，宽高分别是多大。</p><p>center为矩形的中心点，其实就是关于横纵坐标的二元组，因此又有centerx,centery两个属性。此外，还有x，y。</p><h2 id="初次实现（铅锤下降）"><a href="#初次实现（铅锤下降）" class="headerlink" title="初次实现（铅锤下降）"></a>初次实现（铅锤下降）</h2><p>使用诸如Pygame等新工具开发程序时，应让第一个原型尽可能简单，并将重点放在学习新 工具的基本知识，而不是程序本身的细节上。这样做通常大有裨益。因此，在游戏Squish的第一 个版本中，我们只创建重16吨的铅锤从天而降的动画。制作这个动画需要的步骤如下。</p><h3 id="步骤如下："><a href="#步骤如下：" class="headerlink" title="步骤如下："></a>步骤如下：</h3><p>(1) 使用<code>pygame.init</code>、<code>pygame.display.set_mode</code>和<code>pygame.mouse.set_visible</code>初始化<code>Pygame</code>。 使用<code>pygame.display.get_surface</code>获取屏幕表面，使用方法fill以白色填充屏幕表面，再调用 <code>pygame.display.flip</code>显示所做的修改。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">white = <span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span></span><br><span class="line">pygame.init()</span><br><span class="line">screen = pygame<span class="selector-class">.display</span><span class="selector-class">.set_mode</span>((<span class="number">500</span>,<span class="number">500</span>))</span><br><span class="line">pygame<span class="selector-class">.mouse</span><span class="selector-class">.set_visible</span>(True)</span><br><span class="line">pygame<span class="selector-class">.display</span><span class="selector-class">.get_surface</span>()</span><br><span class="line">screen.fill(white)</span><br><span class="line">pygame<span class="selector-class">.display</span><span class="selector-class">.flip</span>()</span><br></pre></td></tr></table></figure><p>(2) 加载铅锤图像。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plumb</span> = pygame.image.load(<span class="string">'plumb.png'</span>)</span><br><span class="line"><span class="attr">plumb</span> = plumb.convert()  <span class="comment">#这将根据当前显示量身定制一个Surface对象，从而最大限度地提高其显示速度。</span></span><br></pre></td></tr></table></figure><p>(3) 使用这幅图像创建自定义类Weight（Sprite的子类）的一个实例。将这个对象添加到Render Updates编组sprites中。（处理多个Sprite对象时，这样做很有帮助。）</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sprites = pygame.sprite.<span class="constructor">RenderUpdates()</span></span><br><span class="line">sprites.add(<span class="constructor">Weight(<span class="params">speed</span>)</span>)</span><br></pre></td></tr></table></figure><p>(4) 使用pygame.event.get获取最近发生的所有事件，并依次检查这些事件。如果发现事件QUIT 或因按下Escape键（K_ESCAPE）而触发的KEYDOWN事件，就退出程序。事件类型和键分别存储在事件对象的属性type和key中。诸如QUIT、KEYDOWN和K_ESCAPE等常量可从模块pygame.locals导入。）</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    <span class="comment"># 检查退出事件</span></span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">        <span class="keyword">if</span> event.type <span class="keyword">in</span> (QUIT, KEYDOWN):</span><br><span class="line">            sys.<span class="keyword">exit</span>()</span><br></pre></td></tr></table></figure><p>(5) 调用编组sprites的方法clear和update。方法clear使用回调函数来清除所有的Sprite对象 （这里是铅锤），而方法update调用Weight实例的方法update（你必须在Weight类中实现方法update）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, *args)</span>:</span></span><br><span class="line">        <span class="string">'''更新下一帧中的铅锤'''</span></span><br><span class="line">        self.rect.top += self.speed</span><br><span class="line">        print(self.rect.top)</span><br><span class="line">        <span class="keyword">if</span> self.rect.top &gt; screen_size[<span class="number">1</span>]:</span><br><span class="line">            print(<span class="string">'over'</span>)</span><br><span class="line">            self.reset()</span><br></pre></td></tr></table></figure><p>(6) 调用sprites.draw并将屏幕表面作为参数，以便在当前位置绘制铅锤（每次调用Weight实例 的update方法后，位置都将发生变化）。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">updates</span> = sprites.draw(screen)</span><br></pre></td></tr></table></figure><p>(7) 调用pygame.display.update，并将sprites.draw返回的矩形列表作为参数，只更新需要更新的部分。（如果你不在乎性能，可使用pygame.display.flip来更新整个屏幕。）</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pygame<span class="selector-class">.display</span><span class="selector-class">.update</span>(updates)</span><br></pre></td></tr></table></figure><p>(8) 重复4-7步</p><p>完整代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span>  randrange</span><br><span class="line"><span class="keyword">from</span> pygame.locals <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Weight</span><span class="params">(pygame.sprite.Sprite)</span>:</span>  <span class="comment"># sprite 模块下的 Sprite</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,speed)</span>:</span></span><br><span class="line">        <span class="comment"># super().__init__(self)  # 有问题这句话</span></span><br><span class="line">        pygame.sprite.Sprite.__init__(self)</span><br><span class="line">        self.speed = speed</span><br><span class="line">        <span class="comment"># 绘制Sprite对象时要用到图像和矩形：</span></span><br><span class="line">        self.image = plumb</span><br><span class="line">        self.rect = self.image.get_rect()</span><br><span class="line">        self.reset()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''将铅锤移动到顶端的一个随机位置'''</span></span><br><span class="line">        self.rect.top = -self.rect.height</span><br><span class="line">        self.rect.centerx = randrange(screen_size[<span class="number">0</span>])</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, *args)</span>:</span></span><br><span class="line">        <span class="string">'''更新下一帧中的铅锤'''</span></span><br><span class="line">        self.rect.top += self.speed</span><br><span class="line">        print(self.rect.top)</span><br><span class="line">        <span class="keyword">if</span> self.rect.top &gt; screen_size[<span class="number">1</span>]:</span><br><span class="line">            print(<span class="string">'over'</span>)</span><br><span class="line">            self.reset()</span><br><span class="line"></span><br><span class="line">white = (<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>)</span><br><span class="line">screen_size = (<span class="number">500</span>,<span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于清除Sprite对象</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clear_callback</span><span class="params">(surf , rect)</span>:</span></span><br><span class="line">    surf.fill(white , rect)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化</span></span><br><span class="line">pygame.init()</span><br><span class="line">screen = pygame.display.set_mode(screen_size)</span><br><span class="line">pygame.mouse.set_visible(<span class="number">0</span>)</span><br><span class="line">pygame.display.get_surface()</span><br><span class="line">screen.fill(white)</span><br><span class="line">pygame.display.flip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载铅锤图像</span></span><br><span class="line">plumb = pygame.image.load(<span class="string">'plumb.png'</span>)</span><br><span class="line">plumb = plumb.convert()  <span class="comment"># )# 以便与显示匹配</span></span><br><span class="line">print(<span class="string">'---&gt;'</span>,plumb.get_rect())  <span class="comment"># 矩形</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置速度</span></span><br><span class="line">speed = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个Sprite对象编组，并向其中添加一个Weight实例</span></span><br><span class="line">sprites = pygame.sprite.RenderUpdates()</span><br><span class="line">sprites.add(Weight(speed))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># 检查退出事件</span></span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">        <span class="keyword">if</span> event.type == QUIT:       <span class="comment"># QUIT 在pygame.locals中</span></span><br><span class="line">            sys.exit()</span><br><span class="line">        <span class="keyword">elif</span> event.type == KEYDOWN <span class="keyword">and</span> event.type == K_ESCAPE :</span><br><span class="line">            sys.exit()</span><br><span class="line">    <span class="comment"># 清除以前的位置</span></span><br><span class="line">    sprites.clear(screen,clear_callback)</span><br><span class="line">    <span class="comment"># 更新所有的Sprite对象；</span></span><br><span class="line">    sprites.update()</span><br><span class="line">    <span class="comment"># 绘制所有的Sprite对象</span></span><br><span class="line">    updates = sprites.draw(screen)</span><br><span class="line">    <span class="comment"># 更新必要的显示部分</span></span><br><span class="line">    pygame.display.update(updates)</span><br><span class="line">    pygame.time.delay(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><h3 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h3><ul><li>所有的Sprite对象都有属性image和rect，其中前者应是一个Surface对象（图像），而后者应是一个矩形对象（只需使用self.image.get_rect()初始化它即可）。绘制Sprite对象时，将用到这两个属性。通过修改self.rect，可移动Sprite对象。</li><li>Surface对象包含方法convert，可用于创建使用不同颜色模式的副本。你无需关心细节， 只需在调用convert时不提供任何参数即可。这将根据当前显示量身定制一个Surface对 象，从而最大限度地提高其显示速度。</li><li>颜色是使用RGB元组（红绿蓝，每个值的取值范围都是0~255）指定的，因此元素(255, 255, 255)表示白色。</li><li>要修改矩形（如这里的self.rect），可设置其属性（top、bottom、left、right、topleft、 topright、bottomleft、bottomright、size、width、height、center、centerx、centery、midleft、 midright、midtop和midbottom），也可调用诸如inflate、move等方法。</li></ul><h2 id="游戏实现"><a href="#游戏实现" class="headerlink" title="游戏实现"></a>游戏实现</h2><h3 id="结果预览"><a href="#结果预览" class="headerlink" title="结果预览"></a>结果预览</h3><p><img src="/pygame学习/20190414-pygame-DIY-banana-and-plumb/%E7%95%8C%E9%9D%A2.png" alt="界面"></p><p>这是游戏界面</p><p><img src="/pygame学习/20190414-pygame-DIY-banana-and-plumb/%E6%B8%B8%E6%88%8F%E4%B8%AD.png" alt="游戏中"></p><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>下图是整个游戏的uml用例图。</p><p><img src="/pygame学习/20190414-pygame-DIY-banana-and-plumb/UML.jpg" alt="UML"></p><ul><li><p>状态类：(<strong>State</strong>)</p><ul><li><p>暂停状态(<strong>Paused</strong>)</p><p><strong>StartUp</strong>（显示启动图像和欢迎消息的暂停状态，后面是<strong>Info</strong>状态）；<strong>Info</strong>（显示游戏信息的暂停状态，后面紧跟第一关） ；<strong>LevelCleard</strong>（已过关的暂停状态）；<strong>GameOver</strong>（游戏已结束的状态，后面是第一关的Level状态）</p></li><li><p>进行状态:</p><p><strong>Level</strong>(游戏关卡)</p></li></ul></li><li><p><strong>Game</strong>（主事件循环）</p></li></ul><p>下图是objects.py的图。</p><p><img src="/pygame学习/20190414-pygame-DIY-banana-and-plumb/UML-objects.jpg" alt="UML-objects"></p><p>总共四个类，Sprite是pygame.sprite模块下的类，我们自定义三个类，其中，SquishSprite是Banana（香蕉）和Weight（铅锤）的父类，它加载香蕉和铅锤的图像，定义了它们的外接矩阵和活动范围。</p><h3 id="config-py"><a href="#config-py" class="headerlink" title="config.py"></a>config.py</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 游戏Squish的配置文件 </span></span><br><span class="line"><span class="comment"># -----------------------------</span></span><br><span class="line"><span class="comment"># 可根据偏好随意修改配置变量 # 如果游戏的节奏太快或太慢，可尝试修改与速度相关的变量</span></span><br><span class="line"><span class="comment"># 要在这个游戏中使用其他图像，可修改这些变量：</span></span><br><span class="line"><span class="attr">banana_image</span> = <span class="string">'banana.jpg'</span></span><br><span class="line"><span class="attr">weight_image</span> = <span class="string">'plumb.jpg'</span></span><br><span class="line"><span class="attr">splash_image</span> = <span class="string">'plumb.jpg'</span></span><br><span class="line"><span class="comment"># 这些配置决定了游戏的总体外观：</span></span><br><span class="line"><span class="attr">screen_size</span> = <span class="number">800</span>, <span class="number">600</span></span><br><span class="line"><span class="attr">background_color</span> = <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>   <span class="comment"># 白色</span></span><br><span class="line"><span class="attr">margin</span> = <span class="number">30</span></span><br><span class="line"><span class="attr">full_screen</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">font_size</span> = <span class="number">40</span></span><br><span class="line"><span class="comment"># 这些设置决定了游戏的行为：</span></span><br><span class="line"><span class="attr">drop_speed</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">banana_speed</span> = <span class="number">10</span></span><br><span class="line"><span class="attr">speed_increase</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">weights_per_level</span> = <span class="number">10</span></span><br><span class="line"><span class="attr">banana_pad_top</span> = <span class="number">4</span></span><br><span class="line"><span class="attr">banana_pad_side</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="objects-py"><a href="#objects-py" class="headerlink" title="objects.py"></a>objects.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame,config,os</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"></span><br><span class="line"><span class="string">"""这个模块包含游戏Squish使用的游戏对象"""</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SquishSprite</span><span class="params">(pygame.sprite.Sprite)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    游戏Squish中所有精灵（sprite）的超类。构造函数加载一张图像，</span></span><br><span class="line"><span class="string">    设置精灵的外接矩形和移动范围。移动范围取决于屏幕尺寸和边距</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,imgae)</span>:</span></span><br><span class="line">        pygame.sprite.Sprite.__init__(self)</span><br><span class="line">        self.image = pygame.image.load(imgae).convert()</span><br><span class="line">        self.rect = self.image.get_rect()</span><br><span class="line">        screen = pygame.display.get_surface()</span><br><span class="line">        shrink = -config.margin * <span class="number">2</span></span><br><span class="line">        <span class="comment"># 定制活动区域</span></span><br><span class="line">        self.area = screen.get_rect().inflate(shrink, shrink)  <span class="comment"># 缩小rect对象的属性。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Weight</span><span class="params">(SquishSprite)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    从天而降的铅锤。使用SquishSprite的构造函数来设置表示铅锤的图像，</span></span><br><span class="line"><span class="string">    并以其构造函数的一个参数指定的速度下降。</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,speed)</span>:</span></span><br><span class="line">        SquishSprite.__init__(self,config.weight_image)</span><br><span class="line">        self.speed = speed</span><br><span class="line">        self.reset()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""将铅锤移到屏幕顶端（使其刚好看不到），并放在一个随机的水平位置"""</span></span><br><span class="line">        x = randrange(self.area.left, self.area.right)</span><br><span class="line">        self.rect.midbottom = x,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        根据据铅锤的速度垂直向下移动相应的距离。</span></span><br><span class="line"><span class="string">        同时，根据铅锤是否已到达屏幕底部相应地设置属性landed</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.rect.top += self.speed</span><br><span class="line">        self.landed = self.rect.top &gt;= self.area.bottom</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Banana</span><span class="params">(SquishSprite)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    使用SquishSprite的构造函数来设置香蕉图像，并停留</span></span><br><span class="line"><span class="string">    在屏幕底部附近，且水平位置由鼠标的当前位置决定（有一定的限制）</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        SquishSprite.__init__(self,config.banana_image)</span><br><span class="line">        self.rect.bottom = self.area.bottom</span><br><span class="line">        <span class="comment"># 这些内边距表示图像中不属于香蕉的部分</span></span><br><span class="line">        <span class="comment">#  如果铅锤进入这些区域，并不认为它砸到了香蕉</span></span><br><span class="line">        self.pad_top = config.banana_pad_top</span><br><span class="line">        self.pad_side = config.banana_pad_side</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        将香蕉中心的x坐标设置为鼠标的当前x坐标，再使用</span></span><br><span class="line"><span class="string">        矩形的方法clamp确保香蕉位于允许的移动范围内</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        self.rect.centerx = pygame.mouse.get_pos()[<span class="number">0</span>]</span><br><span class="line">        self.rect = self.rect.clamp(self.area)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">touches</span><span class="params">(self,other)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">         判断香蕉是否与另一个精灵（如铅锤）发生了碰撞。这里没有直接</span></span><br><span class="line"><span class="string">         使用矩形的方法colliderect，而是先使用矩形的方法inflat以及</span></span><br><span class="line"><span class="string">         pad_side和pad_top计算出一个新的矩形，这个矩形不包含香蕉图</span></span><br><span class="line"><span class="string">         像顶部和两边的“空白”区域</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># 通过剔除内边距来计算bounds：</span></span><br><span class="line">        bounds = self.rect.inflate(- self.pad_side, -self.pad_top)</span><br><span class="line">        <span class="comment"># 将bounds移动到与香蕉底部对齐</span></span><br><span class="line">        bounds.bottom = self.rect.bottom</span><br><span class="line">        <span class="comment"># 检查bounds是否与另一个对象的rect重叠</span></span><br><span class="line">        <span class="keyword">return</span> bounds.colliderect(other.rect)</span><br></pre></td></tr></table></figure><h3 id="squish-py"><a href="#squish-py" class="headerlink" title="squish.py"></a>squish.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os,sys,pygame</span><br><span class="line"><span class="keyword">from</span> pygame.locals <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> objects, config</span><br><span class="line"></span><br><span class="line"><span class="string">"""本模块包含游戏Squish的主游戏逻辑"""</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">State</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    游戏状态超类，能够处理事件以及指定表明上的自己</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self, event)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        只处理退出事件的默认事件处理</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> event.type == QUIT:</span><br><span class="line">            sys.exit()</span><br><span class="line">        <span class="keyword">if</span> event.type == KEYDOWN <span class="keyword">and</span> event.key == K_ESCAPE:</span><br><span class="line">            sys.exit()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">first_display</span><span class="params">(self, screen)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        在首次显示状态时使用，它使用背景色填充屏</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        screen.fill(config.background_color)</span><br><span class="line">        <span class="comment"># 调用flip，将修改反映出来</span></span><br><span class="line">        pygame.display.flip()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">display</span><span class="params">(self,screen)</span>:</span></span><br><span class="line">        <span class="string">"""后续显示状态，其默认行为是什么都不做"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Level</span><span class="params">(State)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    游戏关卡。它计算落下了多少个铅锤，移动精灵并执行其他与游戏逻辑相关的任务</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,number = <span class="number">1</span>)</span>:</span></span><br><span class="line">        self.number = number</span><br><span class="line">        <span class="comment"># 还需要躲开多少个铅锤才能通过当前关卡？</span></span><br><span class="line">        self.remaining = config.weights_per_level</span><br><span class="line"></span><br><span class="line">        speed = config.drop_speed</span><br><span class="line">        <span class="comment"># 每过一关都将速度提高speed_increase：</span></span><br><span class="line">        speed += (self.number - <span class="number">1</span>) * config.speed_increase</span><br><span class="line">        <span class="comment"># 创建铅锤和香蕉：</span></span><br><span class="line">        self.weight = objects.Weight(speed)</span><br><span class="line">        self.banana = objects.Banana()</span><br><span class="line">        both = self.weight,self.banana <span class="comment"># 可包含更多精灵</span></span><br><span class="line">        self.sprites = pygame.sprite.RenderUpdates(both)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, game)</span>:</span></span><br><span class="line">        <span class="string">"""更新游戏状态"""</span></span><br><span class="line">        <span class="string">"""更新所有的精灵"""</span></span><br><span class="line">        self.sprites.update()</span><br><span class="line">        <span class="comment"># 如果香蕉和铅锤发生了碰撞，就让游戏切换到GameOver状态：</span></span><br><span class="line">        <span class="keyword">if</span> self.banana.touches(self.weight):</span><br><span class="line">            game.next_state = GameOver()</span><br><span class="line">        <span class="comment"># 否则，如果铅锤已落到地上，就将其复位</span></span><br><span class="line">        <span class="comment"># 如果躲开了当前关卡内的所有铅锤，就让游戏切换到LevelCleared状态：</span></span><br><span class="line">        <span class="keyword">elif</span> self.weight.landed:</span><br><span class="line">            self.weight.reset()</span><br><span class="line">            self.remaining -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> self.remaining == <span class="number">0</span>:</span><br><span class="line">                game.next_state = LevelCleard(self.number)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">display</span><span class="params">(self,screen)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        在第一次显示（清屏）后显示状态。不同于firstDisplay，</span></span><br><span class="line"><span class="string">        这个方法调用pygame.display.update并向它传递一个需要</span></span><br><span class="line"><span class="string">        更新的矩形列表，这个列表是由self.sprites.draw提供的</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        screen.fill(config.background_color)</span><br><span class="line">        updates = self.sprites.draw(screen)</span><br><span class="line">        pygame.display.update(updates)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Paused</span><span class="params">(State)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    简单的游戏暂停状态，用户可通过按任何键盘键或单击鼠标来结束这种状态</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    finished = <span class="number">0</span> <span class="comment"># 用户结束暂停了吗？</span></span><br><span class="line">    image = <span class="literal">None</span> <span class="comment"># 如果需要显示图像，将这个属性设置为一个文件名</span></span><br><span class="line">    text = <span class="string">''</span>    <span class="comment"># 将这个属性设置为一些说明性文本</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self, event)</span>:</span></span><br><span class="line">        <span class="string">"""这样来处理事件：将这项任务委托给State（它只处理退出事件），</span></span><br><span class="line"><span class="string">        并对按键和鼠标单击做出响应。如果用户按下了键盘键或单击了鼠标，</span></span><br><span class="line"><span class="string">        就将self.finished设置为True</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        State.handle(self, event)</span><br><span class="line">        <span class="keyword">if</span> event.type <span class="keyword">in</span> [MOUSEBUTTONDOWN, KEYDOWN]:</span><br><span class="line">            self.finished = <span class="number">1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, game)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">         更新关卡。如果用户按下了键盘键或单击了鼠标（即self.finished为True），</span></span><br><span class="line"><span class="string">         就让游戏切换到（由子类实现的方法）self.next_state()返回的状态</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.finished:</span><br><span class="line">            game.next_state = self.next_state()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">first_display</span><span class="params">(self, screen)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        在首次显示暂停状态时调用，它绘制图像（如果指定了）并渲染文本</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># 首先,通过使用背景色填充屏幕来清屏:</span></span><br><span class="line">        screen.fill(config.background_color)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建一个使用默认外观和指定字号的Font对象:</span></span><br><span class="line">        font = pygame.font.SysFont(<span class="string">'隶书'</span>, config.font_size)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取self.text中的文本行，但忽略开头和末尾的空行：</span></span><br><span class="line">        lines = self.text.strip().splitlines()</span><br><span class="line"></span><br><span class="line">        <span class="comment">#  使用font.get_linesize()获取每行文本的高度，并计算文本的总高度：</span></span><br><span class="line">        height = len(lines) * font.get_linesize()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算文本的位置（屏幕上居中）</span></span><br><span class="line">        center, top = screen.get_rect().center</span><br><span class="line">        top -= height // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果有图像要显示：</span></span><br><span class="line">        <span class="keyword">if</span> self.image:</span><br><span class="line">            <span class="comment"># 加载该图像：</span></span><br><span class="line">            image = pygame.image.load(self.image).convert()</span><br><span class="line">            <span class="comment"># 获取其rect</span></span><br><span class="line">            r = image.get_rect()</span><br><span class="line">            <span class="comment"># 将文本下移图像高度一半的距离</span></span><br><span class="line">            top += r.height // <span class="number">2</span></span><br><span class="line">            <span class="comment"># 将图像放在文本上方20像素处</span></span><br><span class="line">            r.midbottom = center, top<span class="number">-20</span></span><br><span class="line">            <span class="comment"># 将图像传输到屏幕上</span></span><br><span class="line">            screen.blit(image, r)</span><br><span class="line">        antialia = <span class="number">1</span> <span class="comment"># 消除文本的锯齿</span></span><br><span class="line">        black = <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 从计算得到的top处开始渲染所有的文本行，</span></span><br><span class="line">        <span class="comment"># 每渲染一行都向下移动font.get_linesize()像素</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            text = font.render(line.strip(),antialia, black)</span><br><span class="line">            r = text.get_rect()</span><br><span class="line">            r.midtop = center, top</span><br><span class="line">            screen.blit(text, r)</span><br><span class="line">            top += font.get_linesize()</span><br><span class="line">        <span class="comment"># 显示所做的所有修改</span></span><br><span class="line">        pygame.display.flip()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span><span class="params">(Paused)</span>:</span></span><br><span class="line">    <span class="string">"""显示一些游戏信息的简单暂停状态，紧跟在这个状态后面的是Level状态（第一关） """</span></span><br><span class="line">    next_state = Level</span><br><span class="line">    text = <span class="string">'''</span></span><br><span class="line"><span class="string">    我是一个香蕉，</span></span><br><span class="line"><span class="string">    尽力躲避铅锤吧！</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StartUp</span><span class="params">(Paused)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    显示启动图像和欢迎消息的暂停状态，紧跟在它后面的是Info状态</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    next_state = Info</span><br><span class="line">    image = config.splash_image</span><br><span class="line">    text = <span class="string">"""</span></span><br><span class="line"><span class="string">    小香蕉躲铅锤!</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LevelCleard</span><span class="params">(Paused)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    指出用户已过关的暂停状态，紧跟在它后面的是表示下一关的Level状态</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,number)</span>:</span></span><br><span class="line">        self.number = number</span><br><span class="line">        self.text = <span class="string">f"""通关第<span class="subst">&#123;self.number&#125;</span>关，</span></span><br><span class="line"><span class="string">        单击继续！</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_state</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Level(self.number + <span class="number">1</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GameOver</span><span class="params">(Paused)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    指出游戏已结束的状态，紧跟在它后面的是表示第一关的Level状态</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    next_state = Level</span><br><span class="line">    text = <span class="string">"""</span></span><br><span class="line"><span class="string">    游戏结束</span></span><br><span class="line"><span class="string">    单击重新开始，Esc退出</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    负责主事件循环（包括在不同游戏状态之间切换）的游戏对象</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,  *args)</span>:</span></span><br><span class="line">        <span class="comment"># 获取游戏和图像所在的目录：</span></span><br><span class="line">        path = os.path.abspath(args[<span class="number">0</span>])</span><br><span class="line">        dir = os.path.split(path)[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># 切换到这个目录，以便以后能打开图像文件</span></span><br><span class="line">        os.chdir(dir)</span><br><span class="line">        <span class="comment"># 最初不处于任何状态</span></span><br><span class="line">        self.state = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># 在第一次事件循环迭代中切换到StartUp状态</span></span><br><span class="line">        self.next_state = StartUp()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">         这个方法设置一些变量。它执行一些重要的初始化任务，并进入主事件循环</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># 初始化所有的Pygame模块</span></span><br><span class="line">        pygame.init()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 决定在窗口还是整个屏幕中显示游戏</span></span><br><span class="line">        flag = <span class="number">0</span>    <span class="comment"># 默认在窗口中显示游戏</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> config.full_screen:</span><br><span class="line">            flag = FULLSCREEN <span class="comment"># 全屏模式</span></span><br><span class="line">        screen_size = config.screen_size</span><br><span class="line">        screen = pygame.display.set_mode(screen_size, flag)</span><br><span class="line"></span><br><span class="line">        pygame.display.set_caption(<span class="string">'香蕉的自救'</span>)</span><br><span class="line">        pygame.mouse.set_visible(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 主事件循环</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment">#  (1)如果nextState被修改，就切换到修改后的状态并显示它（首次）：</span></span><br><span class="line">            <span class="keyword">if</span> self.state != self.next_state:</span><br><span class="line">                self.state = self.next_state</span><br><span class="line">                self.state.first_display(screen)</span><br><span class="line">            <span class="comment"># (2)将事件处理工作委托给当前状态：</span></span><br><span class="line">            <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">                self.state.handle(event)</span><br><span class="line">            <span class="comment"># (3)更新当前状态：</span></span><br><span class="line">            self.state.update(self)</span><br><span class="line">            <span class="comment"># (4)显示当前状态：</span></span><br><span class="line">            self.state.display(screen)</span><br><span class="line">            pygame.time.delay(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    game = Game(*sys.argv)</span><br><span class="line">    game.run()</span><br></pre></td></tr></table></figure><h3 id="出现的问题"><a href="#出现的问题" class="headerlink" title="出现的问题"></a>出现的问题</h3><h4 id="只显示铅锤，香蕉并没有显示"><a href="#只显示铅锤，香蕉并没有显示" class="headerlink" title="只显示铅锤，香蕉并没有显示"></a>只显示铅锤，香蕉并没有显示</h4><p>是因为，精灵的活动范围设置的超过了屏幕的尺寸，而且，香蕉是在底部，就造成它没有显示的现象。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">self.area</span> = screen.get_rect().inflate(shrink, shrink)  <span class="comment"># 缩小rect对象的属性。</span></span><br><span class="line"><span class="comment"># 确保：shrink 是一个负数，如果是整数就是放大。</span></span><br></pre></td></tr></table></figure><h4 id="pygame中文乱码问题解决"><a href="#pygame中文乱码问题解决" class="headerlink" title="pygame中文乱码问题解决"></a>pygame中文乱码问题解决</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打印系统支持的字体</span></span><br><span class="line"><span class="builtin-name">print</span>(pygame.font.get_fonts())</span><br><span class="line"><span class="attribute">font</span>=pygame.font.SysFont('隶书',40)</span><br></pre></td></tr></table></figure><hr></div><div><div><div style="text-align:center;color:#555;font-size:14px">-------------The End-------------</div></div></div><div><div class="my_post_copyright"><script src="/js/src/clipboard.min.js"></script><script src="/js/src/jquery2.0/jquery.min.js"></script><script src="/js/src/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/pygame学习/20190414-pygame-DIY-banana-and-plumb.html">pygame练习之DIY街机小游戏</a></p><p><span>文章作者:</span><a href="/" title="访问 Naqin 的个人博客">Naqin</a></p><p><span>发布时间:</span>2019年04月14日 - 19:04</p><p><span>最后更新:</span>2019年11月05日 - 01:11</p><p><span>原始链接:</span><a href="/pygame学习/20190414-pygame-DIY-banana-and-plumb.html" title="pygame练习之DIY街机小游戏">https://chennq.top/pygame学习/20190414-pygame-DIY-banana-and-plumb.html</a> <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://chennq.top/pygame学习/20190414-pygame-DIY-banana-and-plumb.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"><img id="wechat_subscriber_qcode" src="/uploads/wechat.jpg" alt="Naqin wechat" style="width:200px;max-width:100%"><div>欢迎看官加我微信！</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div><button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/uploads/wechatpay.jpg" alt="Naqin 微信支付"><p>微信支付</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/学习笔记/" rel="tag"><i class="fa fa-tag"></i> 学习笔记</a> <a href="/tags/python/" rel="tag"><i class="fa fa-tag"></i> python</a> <a href="/tags/pygame/" rel="tag"><i class="fa fa-tag"></i> pygame</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/learn-python/20190412-python-reflection.html" rel="next" title="Python中的反射"><i class="fa fa-chevron-left"></i> Python中的反射</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/Linux/20190508-Linux-notes.html" rel="prev" title="Linux学习笔记">Linux学习笔记 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div id="gitalk-container"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="https://schema.org/Person"><img class="site-author-image" itemprop="image" src="/uploads/tu6.jpg" alt="Naqin"><p class="site-author-name" itemprop="name">Naqin</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">133</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">30</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">41</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/atlasnq" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:naqin00@hotmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#问题描述"><span class="nav-number">1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#有用的工具"><span class="nav-number">2.</span> <span class="nav-text">有用的工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pygame"><span class="nav-number">2.1.</span> <span class="nav-text">pygame</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pygame-locals"><span class="nav-number">2.2.</span> <span class="nav-text">pygame.locals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pygame-display"><span class="nav-number">2.3.</span> <span class="nav-text">pygame.display</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pygame-font"><span class="nav-number">2.4.</span> <span class="nav-text">pygame.font</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pygame-sprite-（小精灵）"><span class="nav-number">2.5.</span> <span class="nav-text">pygame.sprite （小精灵）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pygame-mouse"><span class="nav-number">2.6.</span> <span class="nav-text">pygame.mouse</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pygame-event"><span class="nav-number">2.7.</span> <span class="nav-text">pygame.event</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pygame-image"><span class="nav-number">2.8.</span> <span class="nav-text">pygame.image</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pygame-Rect"><span class="nav-number">2.9.</span> <span class="nav-text">pygame.Rect</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#初次实现（铅锤下降）"><span class="nav-number">3.</span> <span class="nav-text">初次实现（铅锤下降）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤如下："><span class="nav-number">3.1.</span> <span class="nav-text">步骤如下：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#补充："><span class="nav-number">3.2.</span> <span class="nav-text">补充：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#游戏实现"><span class="nav-number">4.</span> <span class="nav-text">游戏实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#结果预览"><span class="nav-number">4.1.</span> <span class="nav-text">结果预览</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分析"><span class="nav-number">4.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#config-py"><span class="nav-number">4.3.</span> <span class="nav-text">config.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#objects-py"><span class="nav-number">4.4.</span> <span class="nav-text">objects.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#squish-py"><span class="nav-number">4.5.</span> <span class="nav-text">squish.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#出现的问题"><span class="nav-number">4.6.</span> <span class="nav-text">出现的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#只显示铅锤，香蕉并没有显示"><span class="nav-number">4.6.1.</span> <span class="nav-text">只显示铅锤，香蕉并没有显示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pygame中文乱码问题解决"><span class="nav-number">4.6.2.</span> <span class="nav-text">pygame中文乱码问题解决</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-heartbeat"></i> </span><span class="author" itemprop="copyrightHolder">Naqin</span></div><div class="BbeiAn-info">蒙ICP备 - <a class="beian" target="_blank" href="http://www.miitbeian.gov.cn/" style="color:#f7bb30;text-decoration:none!important;border-bottom:none" rel="nofollow">19005279号 </a>| <a class="beian" target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=15012202000146" style="color:#f7bb30;text-decoration:none!important;border-bottom:none;padding-left:30px;background:url(/images/beian.png) no-repeat left center" rel="nofollow">蒙公网安备 15012202000146号</a></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><link rel="stylesheet" href="/css/gitalk.css"><script src="/js/src/gitalk.min.js"></script><div id="gitalk-container"></div><script src="/js/src/md5.min.js"></script><script type="text/javascript">var gitalk=new Gitalk({clientID:"377dab7c4f5a8991f28c",clientSecret:"7440711408c01caf520bc000a5a353aef73a142b",repo:"guestbook",owner:"atlasnq",admin:["atlasnq"],id:md5(location.pathname),distractionFreeMode:"true"});gitalk.render("gitalk-container")</script><script type="text/javascript">// Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script></body></html>