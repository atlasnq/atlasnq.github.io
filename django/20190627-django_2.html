<!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="https://fonts.loli.net/css?family=Noto+Serif+SC:400,500,700&display=swap&subset=chinese-simplified" rel="stylesheet"><link href="https://fonts.loli.net/css?family=Parisienne" rel="stylesheet"><link href="https://fonts.loli.net/css?family=Pinyon+Script" rel="stylesheet"><link href="https://fonts.loli.net/css?family=EB+Garamond:400,500,700" rel="stylesheet"><link href="https://fonts.loli.net/css?family=Source+Code+Pro:400,700" rel="stylesheet"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/logo-32x32.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/logo-16x16.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="django,学习笔记,Web前端,"><meta name="description" content="django第二篇，本篇使用django完成一个图书管理系统。"><meta name="keywords" content="django,学习笔记,Web前端"><meta property="og:type" content="article"><meta property="og:title" content="Django图书管理系统"><meta property="og:url" content="https://chennq.top/django/20190627-django_2.html"><meta property="og:site_name" content="Naqin"><meta property="og:description" content="django第二篇，本篇使用django完成一个图书管理系统。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://chennq.top/django/20190627-django_2/%E6%B7%BB%E5%8A%A0%E5%87%BA%E7%89%88%E7%A4%BE%E4%BF%A1%E6%81%AF.png"><meta property="og:image" content="https://chennq.top/django/20190627-django_2/%E5%87%BA%E7%89%88%E7%A4%BE%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2.png"><meta property="og:image" content="https://chennq.top/django/20190627-django_2/%E5%A2%9E%E5%8A%A0%E5%87%BA%E7%89%88%E7%A4%BE.png"><meta property="og:image" content="https://chennq.top/django/20190627-django_2/%E4%BF%AE%E6%94%B9%E5%87%BA%E7%89%88%E7%A4%BE.png"><meta property="og:image" content="https://chennq.top/django/20190627-django_2/%E6%B7%BB%E5%8A%A0%E4%B9%A6%E7%B1%8D%E4%BF%A1%E6%81%AF.png"><meta property="og:image" content="https://chennq.top/django/20190627-django_2/%E5%9B%BE%E4%B9%A6%E5%B1%95%E7%A4%BA.png"><meta property="og:image" content="https://chennq.top/django/20190627-django_2/%E5%A2%9E%E5%8A%A0%E5%9B%BE%E4%B9%A6.png"><meta property="og:image" content="https://chennq.top/django/20190627-django_2/%E7%BC%96%E8%BE%91%E5%9B%BE%E4%B9%A6.png"><meta property="og:image" content="https://chennq.top/django/20190627-django_2/%E4%BD%9C%E8%80%85%E4%B8%8E%E4%BD%9C%E8%80%85_%E4%B9%A6%E7%B1%8D%E5%85%B3%E7%B3%BB%E8%A1%A8.png"><meta property="og:image" content="https://chennq.top/django/20190627-django_2/%E4%BD%9C%E8%80%85%E4%BF%A1%E6%81%AF.png"><meta property="og:image" content="https://chennq.top/django/20190627-django_2/%E5%A2%9E%E5%8A%A0%E4%BD%9C%E8%80%85.png"><meta property="og:image" content="https://chennq.top/django/20190627-django_2/%E7%BC%96%E8%BE%91%E4%BD%9C%E8%80%85%E4%BF%A1%E6%81%AF.png"><meta property="og:updated_time" content="2019-11-04T16:53:01.887Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Django图书管理系统"><meta name="twitter:description" content="django第二篇，本篇使用django完成一个图书管理系统。"><meta name="twitter:image" content="https://chennq.top/django/20190627-django_2/%E6%B7%BB%E5%8A%A0%E5%87%BA%E7%89%88%E7%A4%BE%E4%BF%A1%E6%81%AF.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"5.1.4",sidebar:{position:"left",display:"hide",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1,dimmer:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!0,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://chennq.top/django/20190627-django_2.html"><title>Django图书管理系统 | Naqin</title><meta name="baidu-site-verification" content="rqAw8UHNKS"><meta name="google-site-verification" content="r_iyjm0f8KcvC9kIpQiyZx3pmWlLY-gwBv9KsOF2AYo"></head><body itemscope itemtype="https://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="https://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Naqin</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Run! Forest,run!</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section">首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section">关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section">标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section">分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section">归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger">搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="https://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://chennq.top/django/20190627-django_2.html"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Naqin"><meta itemprop="description" content><meta itemprop="image" content="/uploads/tu6.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Naqin"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Django图书管理系统</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-27T10:35:07+08:00">2019-06-27 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a></span></span><div class="post-wordcount"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">7.8k 字</span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote class="blockquote-center"><p>django第二篇，本篇使用django完成一个图书管理系统。</p></blockquote><a id="more"></a><hr><p>通过这篇文章，你能了解到：</p><ul><li>使用django完成一个简单的图书管理系统。</li><li>在学习细节之前通过该例来熟悉django的整个流程，所以该例会有很多不足，未来也将用新的知识来进行改进。</li></ul><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>该图书管理系统涉及出版社的管理、图书的管理以及作者的管理。</p><h1 id="出版社的管理"><a href="#出版社的管理" class="headerlink" title="出版社的管理"></a>出版社的管理</h1><ul><li>展示</li><li>新增</li><li>删除</li><li>编辑</li></ul><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>pycharm –》 new project -》 选择解释器，输入app名字，我输入的名字是app01</p><h3 id="settings"><a href="#settings" class="headerlink" title="settings"></a>settings</h3><p>检查 <code>settings.py</code> 配置的内容：</p><ul><li><p>app01已创建</p></li><li><p>注释 <code>MIDDLEWARE</code> 中 关于 <code>csrf</code> 的那一条，防止提交时出现问题</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    <span class="comment">#'django.middleware.csrf.CsrfViewMiddleware',</span></span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>检查 <code>TEMPLATES</code> 中的 <code>DIRS</code> ，cmd创建的需要配置，pycharm不用。</p></li><li><p>在 <code>STATC_URL</code> 后面写 <code>STATICFILES_DIRS</code></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">STATICFILES_DIRS = [</span><br><span class="line">	os<span class="selector-class">.path</span><span class="selector-class">.join</span>(BASE_DIR,<span class="string">'static'</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>note：<code>STATC_URL</code> 只是一个别名，必须配置具体的路径，这样别名才有效。路径中只需要以 <code>/static/</code> 开头就可以。</p></li></ul><h3 id="pymysql"><a href="#pymysql" class="headerlink" title="pymysql"></a>pymysql</h3><p>在做关于数据库的事情之前，我们先切换数据库操作模块（默认只支持python2）</p><ul><li><p>在 <code>settings.py</code> 同目录的 <code>__init__.py</code> 中写如下两条语句：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure></li></ul><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>我们先做的是出版社的管理，所以，先构建关于出版社的表。</p><p>这个表只有两列：pid和出版社名称。</p><ul><li><p>cmd创建一个图书管理系统的数据库</p><p>登录：<code>mysql -u 用户名 -p 密码</code></p><p>创建：<code>create database library;</code></p></li></ul><h3 id="使用orm创建类（对应数据库中的表）"><a href="#使用orm创建类（对应数据库中的表）" class="headerlink" title="使用orm创建类（对应数据库中的表）"></a>使用orm创建类（对应数据库中的表）</h3><ul><li><p>在 <code>models.py</code> 中创建类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publisher</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    pid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>,unique=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"<span class="subst">&#123;self.name&#125;</span>"</span></span><br><span class="line">    __repr__ = __str__</span><br><span class="line">    <span class="comment"># 定义 __repr__是为了在打印对象列表/字典的时候，里面显示的内容为__repr__定义的</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h3><ul><li><p>再次打开 <code>settings.py</code> 配置MySQL 数据库</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'library'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>:<span class="string">'127.0.0.1'</span>,       	<span class="comment"># ip/localhost</span></span><br><span class="line">        <span class="string">'PORT'</span>:<span class="string">'3306'</span>,				<span class="comment"># 端口</span></span><br><span class="line">        <span class="string">'USER'</span>:<span class="string">'xxx'</span>,				<span class="comment"># 用户名</span></span><br><span class="line">        <span class="string">'PASSWORD'</span>:<span class="string">'xxx'</span>,			<span class="comment"># 密码</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="执行迁移"><a href="#执行迁移" class="headerlink" title="执行迁移"></a>执行迁移</h3><ul><li><p><code>python36 manage.py makemigrations</code> 制作迁移文件/变更记录</p></li><li><p><code>python36 manage.py migrate</code> 执行迁移</p></li></ul><h3 id="nvicate-添加记录"><a href="#nvicate-添加记录" class="headerlink" title="nvicate 添加记录"></a>nvicate 添加记录</h3><ul><li><p>添加几条出版社的信息，结果如下</p><p><img src="/django/20190627-django_2/%E6%B7%BB%E5%8A%A0%E5%87%BA%E7%89%88%E7%A4%BE%E4%BF%A1%E6%81%AF.png" alt="添加出版社信息"></p></li></ul><h2 id="展示（查）"><a href="#展示（查）" class="headerlink" title="展示（查）"></a>展示（查）</h2><h3 id="建立对应关系"><a href="#建立对应关系" class="headerlink" title="建立对应关系"></a>建立对应关系</h3><p>开始写函数，首先建立对应关系。在 <code>urls.py</code> 中写如下内容:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^admin/'</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r'^publisher_list/'</span>, views.publisher_list),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>这样 url 与 函数的对应关系就可以建立起来了。</p><h3 id="写对应函数"><a href="#写对应函数" class="headerlink" title="写对应函数"></a>写对应函数</h3><p>在 <code>views.py</code> 中定义 publisher_list</p><p>定义函数的时候，如果没有思路，就从最终目的开始分析，比如这个函数，我们最后的目标是要返回带有数据的页面。所以在这个之前自然就是获取数据喽。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse, redirect</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">publisher_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 从数据库中查询出所有出版社</span></span><br><span class="line">    all_publishers = models.Publisher.objects.all().order_by(<span class="string">'pid'</span>)  <span class="comment"># 按pid排序</span></span><br><span class="line">    print(all_publishers)</span><br><span class="line">    <span class="comment"># 返回页面  页面包含数据</span></span><br><span class="line">    <span class="comment"># return HttpResponse('ok')</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'publisher_list.html'</span>, &#123;<span class="string">'all_publishers'</span>: all_publishers&#125;)</span><br><span class="line">    <span class="comment"># render 第三个参数，让all_publishers 与publisher_list.html 建立联系</span></span><br></pre></td></tr></table></figure><h3 id="写对应HTML"><a href="#写对应HTML" class="headerlink" title="写对应HTML"></a>写对应HTML</h3><p>下面是对应的html页面，使用了bootstrap样式。</p><ol><li><p>首先选取<a href="https://v3.bootcss.com/getting-started/#examples" target="_blank" rel="noopener">bootsrap的实例精选</a>中的控制台，把它的html和css样式扒下来。</p></li><li><p>然后删除左侧栏中多余的内容，删除右侧的全部内容。</p></li><li><p>右侧内容放置一个 table 表格</p></li><li><p>写增加，删除，编辑这几个标签</p></li></ol><p><code>publisher_list.html</code></p><p>这个html页面是最完整的，后面的页面也只是把中间的内容换一下。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Dashboard Template for Bootstrap<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"/static/plugins/bootstrap-3.3.7/css/bootstrap.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"/static/css/dashboard.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.table</span> &gt; <span class="selector-tag">tbody</span> &gt; <span class="selector-tag">tr</span> &gt; <span class="selector-tag">td</span> &#123;</span></span><br><span class="line">            vertical-align: middle;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse navbar-fixed-top"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle collapsed"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">"#navbar"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">aria-expanded</span>=<span class="string">"false"</span> <span class="attr">aria-controls</span>=<span class="string">"navbar"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Project name<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Dashboard<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Settings<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Profile<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Help<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"navbar-form navbar-right"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Search..."</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-3 col-md-2 sidebar"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav nav-sidebar"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/publisher_list/"</span>&gt;</span>出版社<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/book_list/"</span>&gt;</span>图书<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/author_list/"</span>&gt;</span>出版社<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-primary"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span>出版社管理<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/publisher_add"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-sm"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped table-hover"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">th</span>&gt;</span>序号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">th</span>&gt;</span>出版社名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                        &#123;% for publisher in all_publishers %&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; forloop.counter &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; publisher.pk &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; publisher.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/publisher_del/?pk=&#123;&#123; publisher.pk &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-danger"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/publisher_edit/?pk=&#123;&#123; publisher.pk &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-warning"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                        &#123;% endfor %&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">table</span>&gt;</span>                   </span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>模板的语法：</p><ul><li>&#123;&#123; <code>all_publisher</code> &#125;&#125; 表示变量</li><li>&#123; &#37; for i in li &#37; &#125; 表示for循环</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> i <span class="keyword">in</span> all_publishers %&#125;    </span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><ul><li>&#123; &#123; <code>forloop.counter</code> &#125;&#125; 字典，显示循环次数</li></ul><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p><img src="/django/20190627-django_2/%E5%87%BA%E7%89%88%E7%A4%BE%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2.png" alt="出版社管理页面"></p><h2 id="增加"><a href="#增加" class="headerlink" title="增加"></a>增加</h2><h3 id="建立对应关系-1"><a href="#建立对应关系-1" class="headerlink" title="建立对应关系"></a>建立对应关系</h3><p><code>urls.py</code> 下的 <code>urlpatterns</code>中添加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^publisher_add/'</span>, views.publisher_add),</span><br></pre></td></tr></table></figure><h3 id="写对应函数-1"><a href="#写对应函数-1" class="headerlink" title="写对应函数"></a>写对应函数</h3><ul><li>添加记录的两种方式：一种是使用<code>models.Publisher.objects.create(name=pub_name)</code>方式；一种是 <code>obj = models.Publisher(name=pub_name)</code>,但在后面还需要加一句 <code>obj.save()</code> 来提交到数据库。</li></ul><p><code>views.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">publisher_add</span><span class="params">(request)</span>:</span></span><br><span class="line">    error, pub_name = <span class="string">''</span>, <span class="string">''</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        pub_name = request.POST.get(<span class="string">'pub_name'</span>)</span><br><span class="line">        obj = models.Publisher.objects.filter(name=pub_name)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> pub_name:</span><br><span class="line">            <span class="comment"># 提交空数据</span></span><br><span class="line">            error = <span class="string">'数据为空'</span></span><br><span class="line">        <span class="keyword">elif</span> obj:</span><br><span class="line">            <span class="comment"># 表中数据存在</span></span><br><span class="line">            error = <span class="string">'出版社名称重复'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 正确情况下，向数据库添加,并跳转到展示页面</span></span><br><span class="line">            models.Publisher.objects.create(name=pub_name)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/publisher_list/'</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'publisher_add.html'</span>, &#123;<span class="string">'error'</span>: error, <span class="string">'pub_name'</span>: pub_name&#125;)</span><br></pre></td></tr></table></figure><h3 id="写HTML"><a href="#写HTML" class="headerlink" title="写HTML"></a>写HTML</h3><ul><li>只是把原来表格换成表单，表单里放置输入和提交</li></ul><p><code>publisher_list.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-primary"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span>添加出版社<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                 出版社名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"pub_name"</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: red"</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="效果-1"><a href="#效果-1" class="headerlink" title="效果"></a>效果</h3><p><img src="/django/20190627-django_2/%E5%A2%9E%E5%8A%A0%E5%87%BA%E7%89%88%E7%A4%BE.png" alt="增加出版社"></p><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>在这里不需要去写它的HTML页面，我们只需要在 <code>publisher_list.html</code> 的基础上加入 error 提示，就可以。</p><h3 id="建立对应关系-2"><a href="#建立对应关系-2" class="headerlink" title="建立对应关系"></a>建立对应关系</h3><p><code>urls.py</code> 下的 <code>urlpatterns</code>中添加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^publisher_del/'</span>, views.publisher_del),</span><br></pre></td></tr></table></figure><h3 id="写对应函数-2"><a href="#写对应函数-2" class="headerlink" title="写对应函数"></a>写对应函数</h3><ul><li>删除数据有两种方式，一种是<code>对象列表.delete()</code>、一种是 <code>对象.delete()</code></li></ul><p>在<code>views.py</code> 中继续定义：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">publisher_del</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 获取删除的数据   id</span></span><br><span class="line">    error = <span class="string">''</span></span><br><span class="line">    pk = request.GET.get(<span class="string">'pk'</span>)</span><br><span class="line">    query = models.Publisher.objects.filter(pk=pk)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> query:</span><br><span class="line">        <span class="comment"># 数据不存在</span></span><br><span class="line">        error = <span class="string">'要删除的数据不存在'</span></span><br><span class="line">        all_publishers = models.Publisher.objects.all()</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'publisher_list.html'</span>,&#123;<span class="string">"error"</span>:error,<span class="string">"all_publishers"</span>:all_publishers&#125;)</span><br><span class="line">    <span class="comment"># 删除数据</span></span><br><span class="line">    <span class="comment"># 方式一</span></span><br><span class="line">    <span class="comment"># query.delete()  # 通过query_set 删除对象列表中的所有</span></span><br><span class="line">    <span class="comment"># 方式二</span></span><br><span class="line">    query[<span class="number">0</span>].delete()  <span class="comment"># 删除单独的一个对象。</span></span><br><span class="line">    <span class="comment"># 跳转至展示页面</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/publisher_list/'</span>)</span><br></pre></td></tr></table></figure><h3 id="修改publisher-list-html"><a href="#修改publisher-list-html" class="headerlink" title="修改publisher_list.html"></a>修改publisher_list.html</h3><ul><li>只是在<code>&lt;/table&gt;</code> 下加了一个 span</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/publisher_add"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-sm"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped table-hover"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>序号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>出版社名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            &#123;% for publisher in all_publishers %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; forloop.counter &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; publisher.pk &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; publisher.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/publisher_del/?pk=&#123;&#123; publisher.pk &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-danger"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/publisher_edit/?pk=&#123;&#123; publisher.pk &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-warning"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: red"</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h2><p>修改的话，其实和添加很相似了，不过对于编辑，会在输入框中显示原来的内容。</p><ul><li><code>~Q(CSBN=None)</code> 表示 <code>CSBN != None</code></li></ul><h3 id="建立对应关系-3"><a href="#建立对应关系-3" class="headerlink" title="建立对应关系"></a>建立对应关系</h3><p><code>urls.py</code> 下的 <code>urlpatterns</code>中添加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^publisher_edit/'</span>, views.publisher_edit),</span><br></pre></td></tr></table></figure><h3 id="写对应函数-3"><a href="#写对应函数-3" class="headerlink" title="写对应函数"></a>写对应函数</h3><p><code>views.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">publisher_edit</span><span class="params">(request)</span>:</span></span><br><span class="line">    error, pub_name = <span class="string">''</span>, <span class="string">''</span></span><br><span class="line">    <span class="comment"># 对于get请求，回一个编辑页面</span></span><br><span class="line">    pk = request.GET.get(<span class="string">'pk'</span>)  <span class="comment"># url上携带的参数，不仅是get独有的</span></span><br><span class="line">    obj = models.Publisher.objects.filter(pk=pk).first()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> obj:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'数据不存在'</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        <span class="comment"># 获取新提交的数据</span></span><br><span class="line">        pub_name = request.POST.get(<span class="string">'pub_name'</span>)</span><br><span class="line">        check = models.Publisher.objects.filter(name=pub_name).first()  <span class="comment"># 想要改的名字是不能重复的</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> pub_name:</span><br><span class="line">            error = <span class="string">'数据为空'</span></span><br><span class="line">        <span class="keyword">elif</span> check:</span><br><span class="line">            error = <span class="string">'出版社名称重复'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 存在这条数据就修改它</span></span><br><span class="line">            obj.name = pub_name</span><br><span class="line">            obj.save()</span><br><span class="line">            <span class="comment"># 跳转到展示页面</span></span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/publisher_list/'</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'publisher_edit.html'</span>, &#123;<span class="string">'error'</span>: error, <span class="string">'pub_name'</span>: pub_name&#125;)</span><br></pre></td></tr></table></figure><h3 id="写HTML-1"><a href="#写HTML-1" class="headerlink" title="写HTML"></a>写HTML</h3><ul><li>编辑与添加相似，只是增加了对原来输入的显示。</li></ul><p><code>publisher_list.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-primary"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span>添加出版社<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                出版社名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"pub_name"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; pub_name &#125;&#125;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: red"</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="效果-2"><a href="#效果-2" class="headerlink" title="效果"></a>效果</h3><p><img src="/django/20190627-django_2/%E4%BF%AE%E6%94%B9%E5%87%BA%E7%89%88%E7%A4%BE.png" alt="修改出版社"></p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本章回到的知识点有：</p><ul><li><p>render用来展示内容，他不会改变url的路径，只会在后面进行拼接；第三个参数可以向HTML中传递数据。</p></li><li><p>模板语法，如何将数据放到html页面内</p><ul><li>表示变量</li><li>for循环</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> i <span class="keyword">in</span> all_publishers %&#125;    </span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><ul><li>字典，显示循环次数</li></ul></li><li><p>orm操作</p><ul><li>增加 create / 实例化</li><li>删除 对象/对象列表 delete</li><li>修改 对象属性的重新赋值</li></ul></li></ul><h1 id="图书的管理"><a href="#图书的管理" class="headerlink" title="图书的管理"></a>图书的管理</h1><p>增加了图书，宏观上和以前有什么不同？首先，因为有新增了一个类，它们之间就会产生联系，这里假设出版社与图书是一对多关系，所以由此产生外键，这也是下面的一个新知识点。</p><h2 id="准备工作-1"><a href="#准备工作-1" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="使用orm创建类"><a href="#使用orm创建类" class="headerlink" title="使用orm创建类"></a>使用orm创建类</h3><p>打开 <code>models.py</code> 我们将新定义一个类，类名为Book。</p><p>这个类有两个属性，一个是书名 <code>title</code> 一个是出版社的pid（外键），这里假设出版社与书是一对多关系。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    <span class="comment"># pid = models.ForeignKey(Publisher)</span></span><br><span class="line">    pid = models.ForeignKey(<span class="string">'Publisher'</span>,on_delete=models.CASCADE)</span><br><span class="line">    <span class="comment"># 通过反射去拿，这样就没有前后放置的要求</span></span><br><span class="line">    <span class="comment"># 1.11版本默认on_delete=None， None的话，后面会进行警告并重新赋值 on_delete=models.CASCADE</span></span><br><span class="line">    <span class="comment"># 2.0版本 on_delete是必填参数</span></span><br></pre></td></tr></table></figure><p><code>models.ForeignKey(&#39;Publisher&#39;,on_delete= )</code></p><p>对于关键字参数 <code>on_delete</code></p><ul><li>它是指当关联的数据删除时该数据怎么办</li><li><code>on_delete=models.CASCADE</code> 级联删除，关联的数据没有了，该数据也没了</li><li><code>on_delete = models.SET系列</code> 、 SET_DEFAULT设置默认，SET_NULL设为空，SET(VALUE)设为某值。</li><li><code>on_delete = models.Do_NOTHING</code> 啥也不做</li></ul><h3 id="执行迁移-1"><a href="#执行迁移-1" class="headerlink" title="执行迁移"></a>执行迁移</h3><p><code>python manage.py makemigrations</code> 扫描models，记录变更</p><p><code>python manage.py migrate</code> 与数据库同步</p><h3 id="nvicate添加记录"><a href="#nvicate添加记录" class="headerlink" title="nvicate添加记录"></a>nvicate添加记录</h3><p>使用nvicate添加几组数据：</p><p><img src="/django/20190627-django_2/%E6%B7%BB%E5%8A%A0%E4%B9%A6%E7%B1%8D%E4%BF%A1%E6%81%AF.png" alt="添加书籍信息"></p><h2 id="展示"><a href="#展示" class="headerlink" title="展示"></a>展示</h2><h3 id="建立对应关系-4"><a href="#建立对应关系-4" class="headerlink" title="建立对应关系"></a>建立对应关系</h3><p><code>urls.py</code> 下的 <code>urlpatterns</code>中添加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^admin/'</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># publisher 的增删查改</span></span><br><span class="line">    url(<span class="string">r'^publisher_list/'</span>, views.publisher_list),</span><br><span class="line">    url(<span class="string">r'^publisher_add/'</span>, views.publisher_add),</span><br><span class="line">    url(<span class="string">r'^publisher_del/'</span>, views.publisher_del),</span><br><span class="line">    url(<span class="string">r'^publisher_edit/'</span>, views.publisher_edit),</span><br><span class="line">    <span class="comment"># book 的增删查改</span></span><br><span class="line">    url(<span class="string">r'^book_list/'</span>, views.book_list),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="写对应函数-4"><a href="#写对应函数-4" class="headerlink" title="写对应函数"></a>写对应函数</h3><p><code>views.py</code> 中完善函数 book_list</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">book_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    all_books = models.Book.objects.all()</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'book_list.html'</span>,&#123;<span class="string">'all_books'</span>:all_books&#125;)</span><br></pre></td></tr></table></figure><h3 id="写HTML-2"><a href="#写HTML-2" class="headerlink" title="写HTML"></a>写HTML</h3><ul><li>继续使用前面的bootstrap样式</li><li>展示的内容是写在 table 中的。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-primary"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span>图书管理<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/book_add"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-sm"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped table-hover"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>序号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>书名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>出版社<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                &#123;% for book in all_books %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; forloop.counter &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; book.pk &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; book.title &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; book.pid.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/book_del/?pk=&#123;&#123; book.pk &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-sm"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/book_edit/?pk=&#123;&#123; book.pk &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-warning btn-sm"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="效果-3"><a href="#效果-3" class="headerlink" title="效果"></a>效果</h3><p><img src="/django/20190627-django_2/%E5%9B%BE%E4%B9%A6%E5%B1%95%E7%A4%BA.png" alt="图书展示"></p><h2 id="增加-1"><a href="#增加-1" class="headerlink" title="增加"></a>增加</h2><h3 id="建立对应关系-5"><a href="#建立对应关系-5" class="headerlink" title="建立对应关系"></a>建立对应关系</h3><p><code>urls.py</code> 下的 <code>urlpatterns</code>中添加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^book_add/'</span>, views.book_add),</span><br></pre></td></tr></table></figure><h3 id="写对应函数-5"><a href="#写对应函数-5" class="headerlink" title="写对应函数"></a>写对应函数</h3><p><code>views.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">book_add</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 分为get和post请求， get展示添加页面，post提交数据</span></span><br><span class="line">    all_publisher = models.Publisher.objects.all()</span><br><span class="line">    error = <span class="string">''</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        title = request.POST.get(<span class="string">'title'</span>)</span><br><span class="line">        pid_id = request.POST.get(<span class="string">'pid_id'</span>)</span><br><span class="line">        <span class="keyword">if</span> models.Publisher.objects.filter(pid=pid_id):</span><br><span class="line">            models.Book.objects.create(title=title, pid_id=pid_id)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/book_list/'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error = <span class="string">'出版社不存在'</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'book_add.html'</span>, &#123;<span class="string">'all_publisher'</span>: all_publisher, <span class="string">'error'</span>: error&#125;)</span><br><span class="line">    <span class="comment"># 这个return 一个是对get请求的回应，一个是当没有改出版社的时候返回错误。</span></span><br></pre></td></tr></table></figure><h3 id="写HTML-3"><a href="#写HTML-3" class="headerlink" title="写HTML"></a>写HTML</h3><p><code>book_add.html</code></p><ul><li>对于这个页面来说，内容是一个form</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-primary"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span>添加图书<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">class</span>=<span class="string">"form-horizontal col-lg-6 col-lg-offset-3"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"title"</span>&gt;</span>请输入书名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">id</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"title"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"publisher"</span>&gt;</span>选择出版社：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"pid_id"</span> <span class="attr">id</span>=<span class="string">"publisher"</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></span><br><span class="line">                    &#123;% for publishers in all_publisher %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; publishers.pk &#125;&#125;"</span>&gt;</span>&#123;&#123; publishers.name &#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-sm col-lg-offset-4"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="效果-4"><a href="#效果-4" class="headerlink" title="效果"></a>效果</h3><p><img src="/django/20190627-django_2/%E5%A2%9E%E5%8A%A0%E5%9B%BE%E4%B9%A6.png" alt="增加图书"></p><h2 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h2><h3 id="建立对应关系-6"><a href="#建立对应关系-6" class="headerlink" title="建立对应关系"></a>建立对应关系</h3><p><code>urls.py</code> 下的 <code>urlpatterns</code>中添加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^book_del/'</span>, views.book_del),</span><br></pre></td></tr></table></figure><h3 id="写对应函数-6"><a href="#写对应函数-6" class="headerlink" title="写对应函数"></a>写对应函数</h3><p><code>views.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">book_del</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 点击book_list.html的a标签，发出一个url，通过这个url的键来判断</span></span><br><span class="line">    error = <span class="string">''</span></span><br><span class="line">    pk = request.GET.get(<span class="string">'pk'</span>)</span><br><span class="line">    books = models.Book.objects.filter(pk=pk)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> books:</span><br><span class="line">        <span class="comment"># 当不存出版社时返回error提示（恶意修改url）</span></span><br><span class="line">        all_books = models.Book.objects.all()</span><br><span class="line">        error = <span class="string">'出版社不存在'</span></span><br><span class="line">        <span class="comment"># return render(request,'book_del.html',&#123;'error':error,'all_books':all_books&#125;)</span></span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'book_list.html'</span>,&#123;<span class="string">'error'</span>:error,<span class="string">'all_books'</span>:all_books&#125;)</span><br><span class="line">    books.first().delete()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/book_list/'</span>)</span><br></pre></td></tr></table></figure><h3 id="修改HTML"><a href="#修改HTML" class="headerlink" title="修改HTML"></a>修改HTML</h3><p>在<code>book_list.html</code> 增加对error的输出</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/book_add"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-sm"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped table-hover"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>序号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>书名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>出版社<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            &#123;% for book in all_books %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; forloop.counter &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; book.pk &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; book.title &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; book.pid.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/book_del/?pk=&#123;&#123; book.pk &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-sm"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/book_edit/?pk=&#123;&#123; book.pk &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-warning btn-sm"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: red"</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="编辑-1"><a href="#编辑-1" class="headerlink" title="编辑"></a>编辑</h2><h3 id="建立对应关系-7"><a href="#建立对应关系-7" class="headerlink" title="建立对应关系"></a>建立对应关系</h3><p><code>urls.py</code> 下的 <code>urlpatterns</code>中添加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^book_edit/'</span>, views.book_edit),</span><br></pre></td></tr></table></figure><h3 id="写对应函数-7"><a href="#写对应函数-7" class="headerlink" title="写对应函数"></a>写对应函数</h3><p><code>views.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">book_edit</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># get方式展示编辑页面，post方式提交修改的数据</span></span><br><span class="line">    pk = request.GET.get(<span class="string">'pk'</span>)</span><br><span class="line">    error = <span class="string">""</span></span><br><span class="line">    obj = models.Book.objects.filter(pk=pk).first()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> obj:</span><br><span class="line">        error = <span class="string">'查询数据不存在'</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'book_edit.html'</span>, &#123;<span class="string">'error'</span>: error&#125;)</span><br><span class="line">    all_publisher = models.Publisher.objects.all()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        title = request.POST.get(<span class="string">'title'</span>)</span><br><span class="line">        pid_id = request.POST.get(<span class="string">'pid_id'</span>)</span><br><span class="line">        <span class="comment"># 检查出版社是否存在</span></span><br><span class="line">        pid = models.Publisher.objects.filter(pid=pid_id).first()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> pid:</span><br><span class="line">            error = <span class="string">'出版社不存在'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 输入合法，可以修改数据库</span></span><br><span class="line">            obj.title = title</span><br><span class="line">            obj.pid = pid</span><br><span class="line">            obj.save()</span><br><span class="line">            print(<span class="string">'到这里啦'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/book_list/'</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'book_edit.html'</span>, &#123;<span class="string">'book'</span>: obj, <span class="string">'all_publisher'</span>: all_publisher,<span class="string">'error'</span>: error&#125;)</span><br><span class="line">    <span class="comment"># 包含get请求，以及出版社不存在的返回</span></span><br></pre></td></tr></table></figure><h3 id="写THML"><a href="#写THML" class="headerlink" title="写THML"></a>写THML</h3><p><code>book_edit.html</code></p><ul><li>编辑与添加相似，都是在表单中完成的，只不过编辑会将原来用户输入的值显示出来。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span>编辑图书<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"col-sm-2 text-center"</span>&gt;</span>请输入书名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">id</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"col-sm-2 "</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; book.title &#125;&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group "</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"publisher"</span> <span class="attr">class</span>=<span class="string">"col-sm-2 text-center"</span>&gt;</span>选择出版社：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"pid_id"</span> <span class="attr">id</span>=<span class="string">"publisher"</span>&gt;</span></span><br><span class="line">                &#123;% for publishers in all_publisher %&#125;</span><br><span class="line">                &#123;% if book.pid_id == publishers.pid %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; publishers.pk &#125;&#125;"</span> <span class="attr">selected</span>&gt;</span>&#123;&#123; publishers.name &#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                &#123;% else %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; publishers.pk &#125;&#125;"</span>&gt;</span>&#123;&#123; publishers.name &#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-offset-4 col-sm-10"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-sm "</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: red"</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="效果-5"><a href="#效果-5" class="headerlink" title="效果"></a>效果</h3><p><img src="/django/20190627-django_2/%E7%BC%96%E8%BE%91%E5%9B%BE%E4%B9%A6.png" alt="编辑图书"></p><h2 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h2><p>本章完成对图书的增删查改，在出版社的管理的基础上，增加了外键。</p><ol><li><p>对于外键我们使用 <code>pid = models.ForeignKey(&#39;Publisher&#39;,on_delete=models.CASCADE)</code> 来创建外键，这里<code>pid</code>是一个对象，在数据库中实际存在的是<code>pid_id</code>，这样做的好处在于，有了图书这个对象，就可以找到它关联的对象，从而操作这个对象。</p></li><li><p>对于这个方法，里面有一个关键字参数 <code>on_delete</code> 需要我们去选择一种合适的方式，在django1.11.23中可以不设定，但对与django2.0是必须设定的。</p></li><li><p><code>__str__</code> ：当打印对象，先找str方法，没有就去父类中找。</p></li><li><p><code>__repr__</code> ： 当打印对象列表，对象字典的时候，只会调用repr，在类中我们可以写 <code>__repr__ = __str__</code> 来使两个方法相同。</p></li><li><p>模板语法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> 条件 %&#125;</span><br><span class="line">	语句<span class="number">1</span></span><br><span class="line">&#123;% <span class="keyword">elif</span> 条件 %&#125;</span><br><span class="line">	语句<span class="number">2</span></span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">	语句<span class="number">3</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="作者的管理"><a href="#作者的管理" class="headerlink" title="作者的管理"></a>作者的管理</h1><p>作者与书是多对多的关系，对于与这种关系，我们该如何处理呢？这也是本章的核心内容，其余都和前面相似，所以这一部分不会完全复制代码，只将关键步骤和不同之处记录下来。</p><h2 id="准备工作-2"><a href="#准备工作-2" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="使用orm创建类-1"><a href="#使用orm创建类-1" class="headerlink" title="使用orm创建类"></a>使用orm创建类</h3><ul><li>Book或Author中任意一方都可以添加多对多关系。</li><li>使用<code>models.ManyToManyField()</code> 设置</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    books = models.ManyToManyField(<span class="string">'Book'</span>)</span><br><span class="line">    <span class="comment"># 描述多对多关系 ， 不会再数据库中生成该字段，它帮助生成新的关系表。</span></span><br><span class="line">    <span class="comment"># 在Book 或 Author 中都可以去定义，通过Book拿作者 或者通过 作者拿书</span></span><br></pre></td></tr></table></figure><h3 id="执行迁移-2"><a href="#执行迁移-2" class="headerlink" title="执行迁移"></a>执行迁移</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python36 manage.py makemigrations</span><br><span class="line">python36 manage.py migrate</span><br></pre></td></tr></table></figure><h3 id="nvicate添加记录-1"><a href="#nvicate添加记录-1" class="headerlink" title="nvicate添加记录"></a>nvicate添加记录</h3><p>结果如下：</p><p><img src="/django/20190627-django_2/%E4%BD%9C%E8%80%85%E4%B8%8E%E4%BD%9C%E8%80%85_%E4%B9%A6%E7%B1%8D%E5%85%B3%E7%B3%BB%E8%A1%A8.png" alt="作者与作者_书籍关系表"></p><h2 id="展示-1"><a href="#展示-1" class="headerlink" title="展示"></a>展示</h2><h3 id="建立对应关系-8"><a href="#建立对应关系-8" class="headerlink" title="建立对应关系"></a>建立对应关系</h3><p><code>urls.py</code> 下的 <code>urlpatterns</code>中添加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^author_list/'</span>, views.author_list),</span><br></pre></td></tr></table></figure><h3 id="写对应函数-8"><a href="#写对应函数-8" class="headerlink" title="写对应函数"></a>写对应函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">author_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    all_authors = models.Author.objects.all()</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'author_list.html'</span>,&#123;<span class="string">'all_authors'</span>:all_authors&#125;)</span><br></pre></td></tr></table></figure><h3 id="写HTML-4"><a href="#写HTML-4" class="headerlink" title="写HTML"></a>写HTML</h3><ul><li><code>author.books</code>是一个关系管理对象，通过 all 方法可以查询 作者所关联的所有书籍对象。</li><li>模板中函数是不需要加括号的，如 &#123;&#123;author.books.all&#125;&#125;</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>序号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>名字<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>著作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    &#123;% for author in all_authors %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; forloop.counter &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; author.pk &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; author.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                &#123;# author.books.all这里不加括号也是可以的#&#125;</span><br><span class="line">                &#123;% for book in author.books.all %&#125;</span><br><span class="line">                    《&#123;&#123; book.title &#125;&#125;》</span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="效果-6"><a href="#效果-6" class="headerlink" title="效果"></a>效果</h3><p><img src="/django/20190627-django_2/%E4%BD%9C%E8%80%85%E4%BF%A1%E6%81%AF.png" alt="作者信息"></p><h2 id="增加-2"><a href="#增加-2" class="headerlink" title="增加"></a>增加</h2><h3 id="建立对应关系-9"><a href="#建立对应关系-9" class="headerlink" title="建立对应关系"></a>建立对应关系</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^author_add/'</span>, views.author_add),</span><br></pre></td></tr></table></figure><h3 id="写对应函数-9"><a href="#写对应函数-9" class="headerlink" title="写对应函数"></a>写对应函数</h3><ul><li>通过 <code>关系管理对象.set( [1,3,4] )</code> 来为 <code>author_books</code> 关系表中添加内容</li><li>get 只能获取一个元素（最后一个）</li><li>getlist 获取列表</li><li>关系管理对象.set(列表) 列表中的是主键，字符串也不怕，它会帮你处理。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">author_add</span><span class="params">(request)</span>:</span></span><br><span class="line">    all_books = models.Book.objects.all()</span><br><span class="line">    error = <span class="string">''</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        name = request.POST.get(<span class="string">'name'</span>)</span><br><span class="line">        books = request.POST.getlist(<span class="string">'books'</span>)</span><br><span class="line">        books_back = copy.deepcopy(books)</span><br><span class="line">        <span class="keyword">for</span> book <span class="keyword">in</span> all_books:</span><br><span class="line">            <span class="keyword">if</span> str(book.pk) <span class="keyword">in</span> books:</span><br><span class="line">                books.remove(str(book.pk))</span><br><span class="line">        <span class="keyword">if</span> books:</span><br><span class="line">            <span class="comment"># 有不存在的书籍,会产生错误,返回一个错误</span></span><br><span class="line">            error = <span class="string">'部分书籍不存在!'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            obj = models.Author.objects.create(name=name)</span><br><span class="line">            obj.books.set(books_back)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/author_list/'</span>)</span><br><span class="line">    <span class="comment"># 展示 author_add.html 页面</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'author_add.html'</span>, &#123;<span class="string">'all_books'</span>: all_books, <span class="string">'error'</span>: error&#125;)</span><br><span class="line">    <span class="comment"># 包括对部分书籍不存在错误的返回</span></span><br></pre></td></tr></table></figure><h3 id="写HTML-5"><a href="#写HTML-5" class="headerlink" title="写HTML"></a>写HTML</h3><ul><li>书籍是通过 select 来进行选择的，需要加入multiple 。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>姓名:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"books"</span>&gt;</span>著作:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"books"</span> <span class="attr">id</span>=<span class="string">"books"</span> <span class="attr">multiple</span>&gt;</span></span><br><span class="line">        &#123;% for book in all_books %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; book.pk &#125;&#125;"</span>&gt;</span>&#123;&#123; book.title &#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;                            </span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="效果-7"><a href="#效果-7" class="headerlink" title="效果"></a>效果</h3><p><img src="/django/20190627-django_2/%E5%A2%9E%E5%8A%A0%E4%BD%9C%E8%80%85.png" alt="增加作者"></p><h2 id="删除-2"><a href="#删除-2" class="headerlink" title="删除"></a>删除</h2><h3 id="建立对应关系-10"><a href="#建立对应关系-10" class="headerlink" title="建立对应关系"></a>建立对应关系</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^author_del/'</span>, views.author_del),</span><br></pre></td></tr></table></figure><h3 id="写对应函数-10"><a href="#写对应函数-10" class="headerlink" title="写对应函数"></a>写对应函数</h3><p>作者 — 对应表 — 书籍</p><p>删除作者/书籍，任意一方后，对应表中的记录会消失，但是删除了作者，这本书还是存在的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">author_del</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 对url链接内容进行判断,查找作者主键,存在就删除,不存在返回error</span></span><br><span class="line">    pk = request.GET.get(<span class="string">'pk'</span>)</span><br><span class="line">    error = <span class="string">''</span></span><br><span class="line">    author = models.Author.objects.filter(pk=pk)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> author:</span><br><span class="line">        error = <span class="string">'作者不存在!'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        author.delete()</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'/author_list/'</span>)</span><br><span class="line">    all_authors = models.Author.objects.all()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'author_list.html'</span>, &#123;<span class="string">'all_authors'</span>: all_authors, <span class="string">'error'</span>: error&#125;)</span><br></pre></td></tr></table></figure><h3 id="写HTML-6"><a href="#写HTML-6" class="headerlink" title="写HTML"></a>写HTML</h3><p>补全 <code>author_list.html</code> 中的删除</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/book_del/?pk=&#123;&#123; book.pk &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-sm"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="编辑-2"><a href="#编辑-2" class="headerlink" title="编辑"></a>编辑</h2><h3 id="建立对应关系-11"><a href="#建立对应关系-11" class="headerlink" title="建立对应关系"></a>建立对应关系</h3><h3 id="写对应函数-11"><a href="#写对应函数-11" class="headerlink" title="写对应函数"></a>写对应函数</h3><ul><li>对于传入参数中的书籍需要进行检查，对这个列表进行一次深拷贝，不然如果是赋值操作的话，两个列表的内容都会减少。</li><li><code>author.books.set(books_back)</code> 首先会删除所有与这个author对象有关的记录，然后再添加。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">author_edit</span><span class="params">(request)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 展示编辑页面</span></span><br><span class="line">    pk = request.GET.get(<span class="string">'pk'</span>)</span><br><span class="line">    error = <span class="string">''</span></span><br><span class="line">    author = models.Author.objects.filter(pk=pk).first()</span><br><span class="line">    all_books = models.Book.objects.all()</span><br><span class="line">    all_authors = models.Author.objects.all()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> author:</span><br><span class="line">        error = <span class="string">'作者不存在!'</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'author_list.html'</span>, &#123;<span class="string">'all_authors'</span>: all_authors, <span class="string">'error'</span>: error&#125;)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        name = request.POST.get(<span class="string">'name'</span>)</span><br><span class="line">        books = request.POST.getlist(<span class="string">'books'</span>)</span><br><span class="line">        books_back = copy.deepcopy(books)</span><br><span class="line">        <span class="keyword">for</span> book <span class="keyword">in</span> all_books:</span><br><span class="line">            <span class="keyword">if</span> str(book.pk) <span class="keyword">in</span> books:</span><br><span class="line">                books.remove(str(book.pk))</span><br><span class="line">        <span class="keyword">if</span> books:</span><br><span class="line">            error = <span class="string">'部分书籍不存在'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            author.name = name</span><br><span class="line">            author.save()</span><br><span class="line">            print(books_back)</span><br><span class="line">            author.books.set(books_back)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/author_list/'</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'author_edit.html'</span>, &#123;<span class="string">'all_books'</span>: all_books, <span class="string">'author'</span>: author, <span class="string">'error'</span>: error&#125;)</span><br></pre></td></tr></table></figure><h3 id="写HTML-7"><a href="#写HTML-7" class="headerlink" title="写HTML"></a>写HTML</h3><ul><li><p>相对于 author_add.html 增加了值填充，和已选选项提示。</p></li><li><p>可以使用成员判断来找出已选择的书。</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"name"</span> <span class="attr">class</span>=<span class="string">"col-sm-2 col-sm-offset-2 control-label"</span>&gt;</span>名字:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-6"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">id</span>=<span class="string">"name"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; author.name &#125;&#125;"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"books"</span> <span class="attr">class</span>=<span class="string">"col-sm-2 col-sm-offset-2 form-group"</span>&gt;</span>著作:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-6"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"books"</span> <span class="attr">id</span>=<span class="string">"books"</span> <span class="attr">multiple</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></span><br><span class="line">                 &#123;% for book in all_books %&#125;</span><br><span class="line">                 &#123;% if book in author.books.all %&#125;</span><br><span class="line">                 <span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; book.pk &#125;&#125;"</span>&gt;</span>&#123;&#123; book.title &#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                 &#123;% else %&#125;</span><br><span class="line">                 <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; book.pk &#125;&#125;"</span>&gt;</span>&#123;&#123; book.title &#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                 &#123;% endif %&#125;</span><br><span class="line">                 &#123;% endfor %&#125;</span><br><span class="line">             <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-sm col-sm-offset-6 "</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="效果-8"><a href="#效果-8" class="headerlink" title="效果"></a>效果</h3><p><img src="/django/20190627-django_2/%E7%BC%96%E8%BE%91%E4%BD%9C%E8%80%85%E4%BF%A1%E6%81%AF.png" alt="编辑作者信息"></p><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p><code>关系管理对象.set</code> 是先做删除，在做添加。</p><h3 id="正-反向操作"><a href="#正-反向操作" class="headerlink" title="正/反向操作"></a>正/反向操作</h3><h4 id="正向操作"><a href="#正向操作" class="headerlink" title="正向操作"></a>正向操作</h4><ul><li>在我们的orm定义中，<code>ManyToManyField</code> 是定义在Author中的。正向操作就是通过Author对象.books 直接拿到关系管理对象。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    pid = models.ForeignKey(<span class="string">'Publisher'</span>,on_delete=models.CASCADE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    books = models.ManyToManyField(<span class="string">'Book'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line">    __repr__ = __str__</span><br></pre></td></tr></table></figure><h4 id="反向操作"><a href="#反向操作" class="headerlink" title="反向操作"></a>反向操作</h4><p>那通过Book来拿这个关系管理对象就是反向操作了：</p><ul><li>author_set 是一个 关系管理对象，前面的author是根据类名来的，后面的<code>_set</code> 是固定写法。通过它，可以查询 all，可以设置 set 。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(request)</span>:</span></span><br><span class="line">    books = models.Book.objects.all()</span><br><span class="line">    print(<span class="string">'-----------'</span>)</span><br><span class="line">    <span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">        print(book.author_set.all(),type(book.author_set))</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</span><br></pre></td></tr></table></figure><p>note：需要在urls.py中设置对应关系 <code>url(r&#39;^test/&#39;, views.test),</code></p><p>打印如下内容：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;QuerySet [小灰]&gt; &lt;<span class="class"><span class="keyword">class</span> '<span class="title">django</span>.<span class="title">db</span>.<span class="title">models</span>.<span class="title">fields</span>.<span class="title">related_descriptors</span>.<span class="title">create_forward_many_to_many_manager</span>.&lt;locals&gt;.<span class="title">ManyRelatedManager</span>'&gt;</span></span><br><span class="line">&lt;QuerySet [岸本, 七七七]&gt; &lt;<span class="class"><span class="keyword">class</span> '<span class="title">django</span>.<span class="title">db</span>.<span class="title">models</span>.<span class="title">fields</span>.<span class="title">related_descriptors</span>.<span class="title">create_forward_many_to_many_manager</span>.&lt;locals&gt;.<span class="title">ManyRelatedManager</span>'&gt;</span></span><br></pre></td></tr></table></figure><h3 id="创建多对多关系中第三张表的方法"><a href="#创建多对多关系中第三张表的方法" class="headerlink" title="创建多对多关系中第三张表的方法"></a>创建多对多关系中第三张表的方法</h3><h4 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h4><p>django通过<code>ManyToManyField</code>自动创建第三张表</p><ul><li><p>优点：通过 关系管理对象（<code>ManyRelatedManager</code>），可以查询 all ，可以为第三张表添加记录 set</p></li><li><p>缺点：列是固定的（一个主键两个外键，没有其他内容）</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    pub = models.ForeignKey(<span class="string">'Publisher'</span>, on_delete=models.CASCADE)</span><br><span class="line">    <span class="comment"># authors = models.ManyToManyField('Author')  # 描述多对多的关系   不生成字段  生成关系表</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.title</span><br><span class="line"></span><br><span class="line">    __str__ = __repr__</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    books = models.ManyToManyField(<span class="string">'Book'</span>)  <span class="comment"># 描述多对多的关系   不生成字段  生成关系表</span></span><br></pre></td></tr></table></figure><h4 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h4><p>手动创建，添加外键</p><ul><li>优点：你可以自由添加字段</li><li>缺点：没有关系管理对象 ，从book/author不能直接得到 Book_Author的内容。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book_Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    book = models.ForeignKey(Book, on_delete=models.CASCADE)</span><br><span class="line">    author = models.ForeignKey(Author, on_delete=models.CASCADE)</span><br><span class="line">    date = models.DateField()</span><br></pre></td></tr></table></figure><h4 id="方式三"><a href="#方式三" class="headerlink" title="方式三"></a>方式三</h4><p>自己创建 + ManyToManyField</p><ul><li><p>优点：有了 关系管理对象，我们可以查询了 all ，通过 Author.books.all 或 book_set.all 查询；也可以定义额外的字段了</p></li><li><p>缺点：关系管理对象只能查询，不能设置（set），因为有额外的字段，考虑到没有这些字段的情况，从少的一方到多的一方是不能在进行设置的。</p></li><li><p>需要设置 <code>through</code></p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    books = models.ManyToManyField(Book, through=<span class="string">'Book_Author'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book_Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    book = models.ForeignKey(Book, on_delete=models.CASCADE)</span><br><span class="line">    author = models.ForeignKey(Author, on_delete=models.CASCADE)</span><br><span class="line">    date = models.DateField()</span><br></pre></td></tr></table></figure><h3 id="一种特殊情况"><a href="#一种特殊情况" class="headerlink" title="一种特殊情况"></a>一种特殊情况</h3><p>​ 在上面Book_Author这张表中有两个外键，那如果在添加一个 <code>tuijian_author</code> 这个外键，它来自Author，这样我们需要额外设置参数来进行解释，编译器不至于混乱。</p><p>混乱来自：当进行<strong>反向查询</strong>的时候，不知道是 <code>author</code> 还是 <code>tuijian_author</code></p><p>而且如果直接设置两个外键会产生重名问题，出现两个Author.book_author_set</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app02.Book_Author.author: (fields.E304) Reverse accessor <span class="keyword">for</span> <span class="string">'Book_Author.author'</span> clashes <span class="keyword">with</span> reverse accessor <span class="keyword">for</span> <span class="string">'Book_Author.tuijian_author'</span>.</span><br><span class="line">        HINT: Add <span class="keyword">or</span> change a related_name argument to the definition <span class="keyword">for</span> <span class="string">'Book_Author.author'</span> <span class="keyword">or</span> <span class="string">'Book_Author.tuijian_author'</span>.</span><br><span class="line">app02.Book_Author.tuijian_author: (fields.E304) Reverse accessor <span class="keyword">for</span> <span class="string">'Book_Author.tuijian_author'</span> clashes <span class="keyword">with</span> reverse accessor <span class="keyword">for</span> <span class="string">'Book_Author.author'</span>.</span><br><span class="line">        HINT: Add <span class="keyword">or</span> change a related_name argument to the definition <span class="keyword">for</span> <span class="string">'Book_Author.tuijian_author'</span> <span class="keyword">or</span> <span class="string">'Book_Author.author'</span>.</span><br></pre></td></tr></table></figure><ul><li><p>在 <code>ForeignKey</code> 中需要设置 <code>related_name</code>，这在上面的错误中也提到了。</p></li><li><p>在 <code>ManyToManyField</code> 中需要设置<code>through_fields</code> 来指明 Book_Author 中的哪两个字段是多对多关系，而且这个列表是有顺序要求的。</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    books = models.ManyToManyField(Book, through=<span class="string">'Book_Author'</span>, through_fields=[<span class="string">'author'</span>, <span class="string">'book'</span>, ])</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book_Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    book = models.ForeignKey(Book, on_delete=models.CASCADE)</span><br><span class="line">    author = models.ForeignKey(Author, on_delete=models.CASCADE, related_name=<span class="string">'x'</span>)</span><br><span class="line">    tuijian_author = models.ForeignKey(Author, on_delete=models.CASCADE, related_name=<span class="string">'x1'</span>)</span><br><span class="line">    date = models.DateField()</span><br></pre></td></tr></table></figure><h1 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h1><h2 id="django的所有命令"><a href="#django的所有命令" class="headerlink" title="django的所有命令"></a>django的所有命令</h2><ol><li><p>下载安装</p><p>pip install django == 1.11.23 -i 源</p></li><li><p>创建项目</p><p>django-admin startproject 项目名</p></li><li><p>启动项目</p><p>manage.py目录下 ： python manage.py runserver</p></li><li><p>创建app</p><p>python manage.py startapp app名称</p></li><li><p>数据库迁移</p><p>python manage.py makemigrations 扫描app下的models的变更记录 后面可以加具体app名称</p><p>python migrate 同步， 后面可以加具体app名称</p></li></ol><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ol><li><p>TEMPLATES 模板 DIRS</p></li><li><p>静态文件</p><p>STATIC_URL = ‘/static/‘</p><p>STATICFILES_DIRS = [</p><p>​ os.path.join(BASE_DIR, ‘static’),</p><p>]</p></li><li><p>数据库 DATABASES</p><p>ENGIN 引擎</p><p>NAME 数据库名</p><p>HOST</p><p>PORT</p><p>USER</p><p>PASSWORD</p></li><li><p>中间件</p><p>注释csrf，提交post请求</p></li><li><p>注册app</p><p>INSTALL_APPS= [</p><p>‘app01.apps.App01Config’</p><p>]</p></li></ol><h2 id="django使用MySQL数据库的流程"><a href="#django使用MySQL数据库的流程" class="headerlink" title="django使用MySQL数据库的流程"></a>django使用MySQL数据库的流程</h2><ol><li><p>切换数据库操作模块 pymysql， 写在与settings同级目录下的 <code>__init__.py</code></p><p>import pymyysql</p><p>pymysql.install_as_MySQLdb()</p></li><li><p>创建一个MySQL数据库</p></li><li><p>在app下的models中写类</p></li><li><p>制作迁移文件</p></li><li><p>执行数据库迁移命令</p></li></ol><h2 id="request"><a href="#request" class="headerlink" title="request"></a>request</h2><ol><li>request对象：</li><li>GET：url上携带的参数 字典 ?k1=v1</li><li>POST：POST请求的请求数据 get, getlist</li><li>method GET POST PUT</li></ol><h2 id="response"><a href="#response" class="headerlink" title="response"></a>response</h2><ol><li><p>HttpResponse(‘字符串’) 返回字符串</p></li><li><p>render(request,’模板’, { 模板渲染}) 返回一个完整的页面</p></li><li><p>redirect(‘url的路径’) 重定向 响应头 Location：url + 302状态码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># ret = HttpResponse('ok')</span></span><br><span class="line">    response = HttpResponse(status=<span class="number">302</span>)</span><br><span class="line">    response[<span class="string">'Location'</span>] = <span class="string">'/register/'</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure></li></ol><h2 id="orm"><a href="#orm" class="headerlink" title="orm"></a>orm</h2><p>对应关系</p><ul><li>类 表</li><li>对象 记录</li><li>属性 字段</li></ul><h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">models.Publisher.objects.get(name = <span class="string">'xxx'</span>)	<span class="comment"># 获取一个满足条件的对象，找不到或多个就报错</span></span><br><span class="line">models.Publisher.objects.filter()	<span class="comment"># filter 获取满足条件的所有对象，对象列表</span></span><br><span class="line">models.Publisher.objects.all()	<span class="comment"># 获取所有数据</span></span><br><span class="line"></span><br><span class="line">pub.obj.name 			<span class="comment"># 出版社名字</span></span><br><span class="line">pub.obj.pk  pub.obj.pid	<span class="comment"># 出版社的主键</span></span><br><span class="line"></span><br><span class="line">book_obj.pub 			<span class="comment"># 所关联的出版设对象</span></span><br><span class="line">book_obj.pub_id  		<span class="comment"># 所关联的出版社对象的id</span></span><br><span class="line"></span><br><span class="line">author_obj.books		<span class="comment"># 关系管理对象</span></span><br><span class="line">author_obj.books.all()	<span class="comment"># 所关联的所有的书籍对象</span></span><br></pre></td></tr></table></figure><h2 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Publisher</span><br><span class="line"><span class="number">1.</span></span><br><span class="line">	obj = models.Publisher.objects.create(name = <span class="string">'xxx'</span>)</span><br><span class="line"><span class="number">2.</span></span><br><span class="line">    obj = models.Publisher(name = <span class="string">'xxx'</span>)</span><br><span class="line">	obj.save</span><br><span class="line">    </span><br><span class="line">Book：</span><br><span class="line">	models.Book.objects.create(name = <span class="string">'xxx'</span>,pub = pub_obj)</span><br><span class="line">    models.Book.objects.create(name = <span class="string">'xxx'</span>,pub_id = pub_obj.pk)</span><br><span class="line">Author:</span><br><span class="line">    author_obj = models.Author.objects.create(name = <span class="string">'xxx'</span>)</span><br><span class="line">    author_obj.books.set([<span class="number">1</span>,<span class="number">2</span>])	<span class="comment"># 设置多对多的关系</span></span><br></pre></td></tr></table></figure><h2 id="删除-3"><a href="#删除-3" class="headerlink" title="删除"></a>删除</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查询这个对象/对象列表  -&gt; delete</span><br><span class="line">models.Publisher.objects.filter(pk=pk).delete()</span><br><span class="line">author_obj.delete()</span><br></pre></td></tr></table></figure><h2 id="编辑-3"><a href="#编辑-3" class="headerlink" title="编辑"></a>编辑</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">book_obj.pub = pub_obj</span><br><span class="line">book_obj.pub_id = pub_obj.pk</span><br><span class="line">author_obj.name = name</span><br><span class="line">author_obj.save()</span><br><span class="line">author_obj.books.set([id,id])</span><br></pre></td></tr></table></figure><h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><p>render(request, ‘模板的文件名’,{k1:v1})</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;k1&#125;&#125;  v1</span><br><span class="line">&#123;% if 条件 %&#125;</span><br><span class="line">	x1</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">	x2</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% for i in iter %&#125;</span><br><span class="line">	&#123;&#123;forloop.counter&#125;&#125;</span><br><span class="line">	&#123;&#123;i&#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p>下一篇为 <a href="https://chennq.com/django/20190701-django_3.html" target="_blank" rel="noopener">Django模板系统</a>，第一个需要了解的细节，学习了这一块，就可以得到任何想要的页面。</p></div><div><div><div style="text-align:center;color:#555;font-size:14px">-------------The End-------------</div></div></div><div><div class="my_post_copyright"><script src="/js/src/clipboard.min.js"></script><script src="/js/src/jquery2.0/jquery.min.js"></script><script src="/js/src/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/django/20190627-django_2.html">Django图书管理系统</a></p><p><span>文章作者:</span><a href="/" title="访问 Naqin 的个人博客">Naqin</a></p><p><span>发布时间:</span>2019年06月27日 - 10:06</p><p><span>最后更新:</span>2019年11月05日 - 00:11</p><p><span>原始链接:</span><a href="/django/20190627-django_2.html" title="Django图书管理系统">https://chennq.top/django/20190627-django_2.html</a> <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://chennq.top/django/20190627-django_2.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"><img id="wechat_subscriber_qcode" src="/uploads/wechat.jpg" alt="Naqin wechat" style="width:200px;max-width:100%"><div>欢迎看官加我微信！</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div><button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/uploads/wechatpay.jpg" alt="Naqin 微信支付"><p>微信支付</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/django/" rel="tag"><i class="fa fa-tag"></i> django</a> <a href="/tags/学习笔记/" rel="tag"><i class="fa fa-tag"></i> 学习笔记</a> <a href="/tags/Web前端/" rel="tag"><i class="fa fa-tag"></i> Web前端</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/Pytorch学习笔记/20190626-learning_PyTorch_4_dim.html" rel="next" title="Pytorch-维度变化"><i class="fa fa-chevron-left"></i> Pytorch-维度变化</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/Pytorch学习笔记/20190627-learning_PyTorch_5_concat_split.html" rel="prev" title="Pytorch-拼接与拆分">Pytorch-拼接与拆分 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div id="gitalk-container"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="https://schema.org/Person"><img class="site-author-image" itemprop="image" src="/uploads/tu6.jpg" alt="Naqin"><p class="site-author-name" itemprop="name">Naqin</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">129</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">43</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/atlasnq" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:naqin00@hotmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#概述"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#出版社的管理"><span class="nav-number">2.</span> <span class="nav-text">出版社的管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备工作"><span class="nav-number">2.1.</span> <span class="nav-text">准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建项目"><span class="nav-number">2.1.1.</span> <span class="nav-text">创建项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#settings"><span class="nav-number">2.1.2.</span> <span class="nav-text">settings</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pymysql"><span class="nav-number">2.1.3.</span> <span class="nav-text">pymysql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建数据库"><span class="nav-number">2.1.4.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用orm创建类（对应数据库中的表）"><span class="nav-number">2.1.5.</span> <span class="nav-text">使用orm创建类（对应数据库中的表）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置数据库"><span class="nav-number">2.1.6.</span> <span class="nav-text">配置数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行迁移"><span class="nav-number">2.1.7.</span> <span class="nav-text">执行迁移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nvicate-添加记录"><span class="nav-number">2.1.8.</span> <span class="nav-text">nvicate 添加记录</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#展示（查）"><span class="nav-number">2.2.</span> <span class="nav-text">展示（查）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立对应关系"><span class="nav-number">2.2.1.</span> <span class="nav-text">建立对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应函数"><span class="nav-number">2.2.2.</span> <span class="nav-text">写对应函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应HTML"><span class="nav-number">2.2.3.</span> <span class="nav-text">写对应HTML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果"><span class="nav-number">2.2.4.</span> <span class="nav-text">效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增加"><span class="nav-number">2.3.</span> <span class="nav-text">增加</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立对应关系-1"><span class="nav-number">2.3.1.</span> <span class="nav-text">建立对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应函数-1"><span class="nav-number">2.3.2.</span> <span class="nav-text">写对应函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写HTML"><span class="nav-number">2.3.3.</span> <span class="nav-text">写HTML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果-1"><span class="nav-number">2.3.4.</span> <span class="nav-text">效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除"><span class="nav-number">2.4.</span> <span class="nav-text">删除</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立对应关系-2"><span class="nav-number">2.4.1.</span> <span class="nav-text">建立对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应函数-2"><span class="nav-number">2.4.2.</span> <span class="nav-text">写对应函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改publisher-list-html"><span class="nav-number">2.4.3.</span> <span class="nav-text">修改publisher_list.html</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编辑"><span class="nav-number">2.5.</span> <span class="nav-text">编辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立对应关系-3"><span class="nav-number">2.5.1.</span> <span class="nav-text">建立对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应函数-3"><span class="nav-number">2.5.2.</span> <span class="nav-text">写对应函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写HTML-1"><span class="nav-number">2.5.3.</span> <span class="nav-text">写HTML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果-2"><span class="nav-number">2.5.4.</span> <span class="nav-text">效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结"><span class="nav-number">2.6.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#图书的管理"><span class="nav-number">3.</span> <span class="nav-text">图书的管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备工作-1"><span class="nav-number">3.1.</span> <span class="nav-text">准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用orm创建类"><span class="nav-number">3.1.1.</span> <span class="nav-text">使用orm创建类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行迁移-1"><span class="nav-number">3.1.2.</span> <span class="nav-text">执行迁移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nvicate添加记录"><span class="nav-number">3.1.3.</span> <span class="nav-text">nvicate添加记录</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#展示"><span class="nav-number">3.2.</span> <span class="nav-text">展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立对应关系-4"><span class="nav-number">3.2.1.</span> <span class="nav-text">建立对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应函数-4"><span class="nav-number">3.2.2.</span> <span class="nav-text">写对应函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写HTML-2"><span class="nav-number">3.2.3.</span> <span class="nav-text">写HTML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果-3"><span class="nav-number">3.2.4.</span> <span class="nav-text">效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增加-1"><span class="nav-number">3.3.</span> <span class="nav-text">增加</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立对应关系-5"><span class="nav-number">3.3.1.</span> <span class="nav-text">建立对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应函数-5"><span class="nav-number">3.3.2.</span> <span class="nav-text">写对应函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写HTML-3"><span class="nav-number">3.3.3.</span> <span class="nav-text">写HTML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果-4"><span class="nav-number">3.3.4.</span> <span class="nav-text">效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除-1"><span class="nav-number">3.4.</span> <span class="nav-text">删除</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立对应关系-6"><span class="nav-number">3.4.1.</span> <span class="nav-text">建立对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应函数-6"><span class="nav-number">3.4.2.</span> <span class="nav-text">写对应函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改HTML"><span class="nav-number">3.4.3.</span> <span class="nav-text">修改HTML</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编辑-1"><span class="nav-number">3.5.</span> <span class="nav-text">编辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立对应关系-7"><span class="nav-number">3.5.1.</span> <span class="nav-text">建立对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应函数-7"><span class="nav-number">3.5.2.</span> <span class="nav-text">写对应函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写THML"><span class="nav-number">3.5.3.</span> <span class="nav-text">写THML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果-5"><span class="nav-number">3.5.4.</span> <span class="nav-text">效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结-1"><span class="nav-number">3.6.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#作者的管理"><span class="nav-number">4.</span> <span class="nav-text">作者的管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备工作-2"><span class="nav-number">4.1.</span> <span class="nav-text">准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用orm创建类-1"><span class="nav-number">4.1.1.</span> <span class="nav-text">使用orm创建类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行迁移-2"><span class="nav-number">4.1.2.</span> <span class="nav-text">执行迁移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nvicate添加记录-1"><span class="nav-number">4.1.3.</span> <span class="nav-text">nvicate添加记录</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#展示-1"><span class="nav-number">4.2.</span> <span class="nav-text">展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立对应关系-8"><span class="nav-number">4.2.1.</span> <span class="nav-text">建立对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应函数-8"><span class="nav-number">4.2.2.</span> <span class="nav-text">写对应函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写HTML-4"><span class="nav-number">4.2.3.</span> <span class="nav-text">写HTML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果-6"><span class="nav-number">4.2.4.</span> <span class="nav-text">效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增加-2"><span class="nav-number">4.3.</span> <span class="nav-text">增加</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立对应关系-9"><span class="nav-number">4.3.1.</span> <span class="nav-text">建立对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应函数-9"><span class="nav-number">4.3.2.</span> <span class="nav-text">写对应函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写HTML-5"><span class="nav-number">4.3.3.</span> <span class="nav-text">写HTML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果-7"><span class="nav-number">4.3.4.</span> <span class="nav-text">效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除-2"><span class="nav-number">4.4.</span> <span class="nav-text">删除</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立对应关系-10"><span class="nav-number">4.4.1.</span> <span class="nav-text">建立对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应函数-10"><span class="nav-number">4.4.2.</span> <span class="nav-text">写对应函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写HTML-6"><span class="nav-number">4.4.3.</span> <span class="nav-text">写HTML</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编辑-2"><span class="nav-number">4.5.</span> <span class="nav-text">编辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立对应关系-11"><span class="nav-number">4.5.1.</span> <span class="nav-text">建立对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写对应函数-11"><span class="nav-number">4.5.2.</span> <span class="nav-text">写对应函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写HTML-7"><span class="nav-number">4.5.3.</span> <span class="nav-text">写HTML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果-8"><span class="nav-number">4.5.4.</span> <span class="nav-text">效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#补充"><span class="nav-number">4.6.</span> <span class="nav-text">补充</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#正-反向操作"><span class="nav-number">4.6.1.</span> <span class="nav-text">正/反向操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#正向操作"><span class="nav-number">4.6.1.1.</span> <span class="nav-text">正向操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#反向操作"><span class="nav-number">4.6.1.2.</span> <span class="nav-text">反向操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建多对多关系中第三张表的方法"><span class="nav-number">4.6.2.</span> <span class="nav-text">创建多对多关系中第三张表的方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#方式一"><span class="nav-number">4.6.2.1.</span> <span class="nav-text">方式一</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方式二"><span class="nav-number">4.6.2.2.</span> <span class="nav-text">方式二</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方式三"><span class="nav-number">4.6.2.3.</span> <span class="nav-text">方式三</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一种特殊情况"><span class="nav-number">4.6.3.</span> <span class="nav-text">一种特殊情况</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#小结-2"><span class="nav-number">5.</span> <span class="nav-text">小结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#django的所有命令"><span class="nav-number">5.1.</span> <span class="nav-text">django的所有命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置"><span class="nav-number">5.2.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#django使用MySQL数据库的流程"><span class="nav-number">5.3.</span> <span class="nav-text">django使用MySQL数据库的流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#request"><span class="nav-number">5.4.</span> <span class="nav-text">request</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#response"><span class="nav-number">5.5.</span> <span class="nav-text">response</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#orm"><span class="nav-number">5.6.</span> <span class="nav-text">orm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询"><span class="nav-number">5.7.</span> <span class="nav-text">查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#新增"><span class="nav-number">5.8.</span> <span class="nav-text">新增</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除-3"><span class="nav-number">5.9.</span> <span class="nav-text">删除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编辑-3"><span class="nav-number">5.10.</span> <span class="nav-text">编辑</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模板"><span class="nav-number">5.11.</span> <span class="nav-text">模板</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-heartbeat"></i> </span><span class="author" itemprop="copyrightHolder">Naqin</span></div><div class="BbeiAn-info">蒙ICP备 - <a class="beian" target="_blank" href="http://www.miitbeian.gov.cn/" style="color:#f7bb30;text-decoration:none!important;border-bottom:none" rel="nofollow">19005279号 </a>| <a class="beian" target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=15012202000146" style="color:#f7bb30;text-decoration:none!important;border-bottom:none;padding-left:30px;background:url(/images/beian.png) no-repeat left center" rel="nofollow">蒙公网安备 15012202000146号</a></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><link rel="stylesheet" href="/css/gitalk.css"><script src="/js/src/gitalk.min.js"></script><div id="gitalk-container"></div><script src="/js/src/md5.min.js"></script><script type="text/javascript">var gitalk=new Gitalk({clientID:"377dab7c4f5a8991f28c",clientSecret:"7440711408c01caf520bc000a5a353aef73a142b",repo:"guestbook",owner:"atlasnq",admin:["atlasnq"],id:md5(location.pathname),distractionFreeMode:"true"});gitalk.render("gitalk-container")</script><script type="text/javascript">// Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script></body></html>